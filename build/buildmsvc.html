<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia Site Renderer 1.6 at 2015-12-19 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>PostgreSQL PL/Java &#x2013; Building PL/Java with Microsoft Visual Studio</title>
    <style type="text/css" media="all">
      @import url("../css/maven-base.css");
      @import url("../css/maven-theme.css");
      @import url("../css/site.css");
    </style>
    <link rel="stylesheet" href="../css/print.css" type="text/css" media="print" />
    <meta name="Date-Revision-yyyymmdd" content="20151219" />
    <meta http-equiv="Content-Language" content="en" />
        
        </head>
  <body class="composite">
    <div id="banner">
                        <a href="https://tada.github.io/pljava/" id="bannerLeft" title="PL/Java logo combining the PostgreSQL elephant and a Java bean">
                                                <img src="../images/pljava_logo.jpg" alt="PL/Java logo combining the PostgreSQL elephant and a Java bean" />
                </a>
                    <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
            
                    
                <div class="xleft">
        <span id="publishDate">Last Published: 2015-12-19</span>
                  &nbsp;| <span id="projectVersion">Version: 1.5.0-SNAPSHOT</span>
                      </div>
            <div class="xright">                    <a href="https://github.com/tada/pljava/wiki/" class="externalLink" title="Wiki">Wiki</a>
            |
                        <a href="https://github.com/tada/pljava/issues" class="externalLink" title="Issues">Issues</a>
            |
                        <a href="http://lists.pgfoundry.org/pipermail/pljava-dev/" class="externalLink" title="Mailing list">Mailing list</a>
            |
                        <a href="https://github.com/tada/pljava/tree/master/" class="externalLink" title="Code">Code</a>
              
                    
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
             
                    
                                <h5>Usage</h5>
                  <ul>
                  <li class="none">
                          <a href="../build/build.html" title="Building PL/Java">Building PL/Java</a>
            </li>
                  <li class="none">
                          <a href="../install/install.html" title="Installing into PostgreSQL">Installing into PostgreSQL</a>
            </li>
                  <li class="none">
                          <a href="../use/use.html" title="User guide">User guide</a>
            </li>
          </ul>
                       <h5>Modules</h5>
                  <ul>
                  <li class="none">
                          <a href="../pljava-api/index.html" title="PL/Java API">PL/Java API</a>
            </li>
                  <li class="none">
                          <a href="../pljava/index.html" title="PL/Java backend Java code">PL/Java backend Java code</a>
            </li>
                  <li class="none">
                          <a href="../pljava-so/index.html" title="PL/Java backend native code">PL/Java backend native code</a>
            </li>
                  <li class="none">
                          <a href="../pljava-deploy/index.html" title="PL/Java Deploy">PL/Java Deploy</a>
            </li>
                  <li class="none">
                          <a href="../pljava-ant/index.html" title="PL/Java Ant tasks">PL/Java Ant tasks</a>
            </li>
                  <li class="none">
                          <a href="../pljava-examples/index.html" title="PL/Java examples">PL/Java examples</a>
            </li>
                  <li class="none">
                          <a href="../packaging/index.html" title="PL/Java packaging">PL/Java packaging</a>
            </li>
          </ul>
                       <h5>Project Documentation</h5>
                  <ul>
                                                                                                                                                                                                                                                                          <li class="collapsed">
                          <a href="../project-info.html" title="Project Information">Project Information</a>
                  </li>
          </ul>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="../images/logos/maven-feather.png" />
      </a>
                   
                    
            </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <h1>Building PL/Java with Microsoft Visual Studio</h1>
<p>PL/Java may be built on Windows using the compilers in Microsoft Visual Studio (including the Express and Community editions).</p>
<p>Most Windows users will install PostgreSQL using the binary distributions from <a class="externalLink" href="http://www.enterprisedb.com/products-services-training/pgdownload">EnterpriseDB</a>. You may find that using the same version of Visual Studio to compile PL/Java as that used by EnterpriseDB to compile their PostgreSQL distribution will result in fewer compile warnings and a somewhat smaller runtime memory footprint because the same runtime DLLs will be used by both PostgreSQL and PL/Java. Using a <i>newer</i> version of Visual Studio (including the Community 2015 version) will generally work, while older versions are more likely to be problematic.</p>

<ul>
  
<li>PostgreSQL 9.1 to 9.3 were built using Visual Studio 2010.</li>
  
<li>PostgreSQL 9.4 was built using Visual Studio 2013.</li>
</ul>
<div class="section">
<h2><a name="Software_Prerequisites"></a>Software Prerequisites</h2>

<ol style="list-style-type: decimal">
  
<li>
<p>You will need an appropriate version of <a class="externalLink" href="https://www.visualstudio.com/downloads/download-visual-studio-vs">Microsoft Visual Studio</a>. When installing Visual Studio be sure to select the &#x201c;compiler tools&#x201d; option so that the command line compiler is installed.</p></li>
  
<li>
<p>The <a class="externalLink" href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">Java Development Kit</a> (not just the Java Runtime Environment) version that you plan to use. that you plan to use should be installed, also ideally in your PATH environment variable so that</p>
  
<div class="source">
<div class="source">
<pre>javac  -version
</pre></div></div>
<p>just works.</p></li>
  
<li>
<p>The PostgreSQL server version that you intend to use should be installed, and on your PATH so that the command</p>
  
<div class="source">
<div class="source">
<pre>pg_config
</pre></div></div>
<p>succeeds.</p></li>
  
<li>
<p>Development files (mostly <tt>.h</tt> files) for that PostgreSQL version must also be installed. To check, look in the output of that <tt>pg_config</tt> command for an <tt>INCLUDEDIR-SERVER</tt> line, and list the directory it refers to. There should be a bunch of <tt>*.h</tt> files there.</p></li>
  
<li>
<p>You will need to install <a class="externalLink" href="https://maven.apache.org/">Maven</a> and add it to your PATH so that</p>
  
<div class="source">
<div class="source">
<pre>mvn --version
</pre></div></div>
<p>just works.</p></li>
  
<li>
<p>You will need either <a class="externalLink" href="https://git-scm.com/downloads">Git</a> or <a class="externalLink" href="https://desktop.github.com/">GitHub for Windows</a>. If you are using Git, add it to your PATH so that</p>
  
<div class="source">
<div class="source">
<pre>git --version
</pre></div></div>
<p>just works.</p></li>
</ol>
<p>You <b>must</b> match the 32-bit vs 64-bit version of the Java JVM, C compiler and PostgreSQL installation used to build PL/Java. (All must be either 32-bit or 64-bit.)</p>
<p>If you have more than one version installed of PostgreSQL, Java, or the compile/link tools, make sure the ones found on your search path are the ones you plan to use, and the version-test commands above give the output you expect.</p></div>
<div class="section">
<h2><a name="Visual_C_Configuration"></a>Visual C Configuration</h2>
<p>You will need to open a command window with the appropriate Visual C native tools environment variables defined. You may do this by using the preconfigured links accessible from the Start menu (for example at <tt>Visual Studio 2013 | Visual Studio Tools</tt>) or by creating a desktop shortcut for the tools. </p>

<ul>
  
<li>
<p>Visual Studio 2013:</p>
  
<div class="source">
<div class="source">
<pre>&quot;C:\Program Files (x86)\Microsoft Visual Studio 12.0\VC\vcvarsall.bat&quot; x86
&quot;C:\Program Files (x86)\Microsoft Visual Studio 12.0\VC\vcvarsall.bat&quot; amd64
</pre></div></div></li>
  
<li>
<p>Visual Studio 2010:</p>
  
<div class="source">
<div class="source">
<pre>&quot;C:\Program Files (x86)\Microsoft Visual Studio 10.0\VC\vcvarsall.bat&quot; x86
&quot;C:\Program Files (x86)\Microsoft Visual Studio 10.0\VC\vcvarsall.bat&quot; amd64
</pre></div></div></li>
</ul></div>
<div class="section">
<h2><a name="Obtaining_PLJava_sources"></a>Obtaining PL/Java sources</h2>
<p>You may use GitHub for Windows to <tt>clone</tt> the PL/Java GitHub repository by opening your browser to</p>

<div class="source">
<div class="source">
<pre>https://github.com/tada/pljava
</pre></div></div>
<p>and clicking on the appropriate icon. At the time these notes were written, the icon is located to the left of the &#x201c;Download ZIP&#x201d; button.</p>
<p>Alternatively you may use <a class="externalLink" href="https://git-scm.com/downloads">git</a> to <tt>clone</tt> the PL/Java GitHub repository, using either of these commands:</p>

<div class="source">
<div class="source">
<pre>git clone https://github.com/tada/pljava.git
git clone ssh://git@github.com/tada/pljava.git
</pre></div></div>
<p>The second only works if you have a GitHub account, but has the advantage of being faster if you do <tt>git pull</tt> later on to stay in sync with updated sources.</p></div>
<div class="section">
<h2><a name="Building_PLJava"></a>Building PL/Java</h2>

<ol style="list-style-type: decimal">
  
<li>
<p>Open a command window using the Visual Studio shortcut for the appropriate version.</p></li>
  
<li>
<p>To start the build, your current directory should be the one the sources were checked out into. In the command window, change the directory to the location of the cloned PL/Java repository. For example,</p>
  
<div class="source">
<div class="source">
<pre>cd C:\GitHub\pljava
</pre></div></div>
<p>Looking around, there should be a <tt>pom.xml</tt> file there, and several subdirectories <tt>pljava</tt>, <tt>pljava-api</tt>, <tt>pljava-so</tt>, etc.</p></li>
  
<li>
<p>PL/Java is built using <a class="externalLink" href="https://maven.apache.org/">Apache Maven</a>.</p>
  
<div class="source">
<div class="source">
<pre>mvn  clean  install
</pre></div></div>
<p>This command will build PL/Java and produce the files you need, but does not install them as a language in PostgreSQL. To complete that step, proceed to the <a href="../install/install.html">installation instructions</a>.</p></li>
</ol>
<p>A successful <tt>mvn clean install</tt> should produce output like this near the end:</p>

<div class="source">
<div class="source">
<pre>[INFO] PostgreSQL PL/Java ................................ SUCCESS
[INFO] PL/Java API ....................................... SUCCESS
[INFO] PL/Java backend Java code ......................... SUCCESS
[INFO] PL/Java backend native code ....................... SUCCESS
[INFO] PL/Java Deploy .................................... SUCCESS
[INFO] PL/Java Ant tasks ................................. SUCCESS
[INFO] PL/Java examples .................................. SUCCESS
[INFO] PL/Java packaging ................................. SUCCESS
</pre></div></div>
<p>(the real output will include timings on each line). You will then be ready to <a href="../install/install.html">try out PL/Java in PostgreSQL</a>.</p>
<div class="section">
<h3><a name="I_know_PostgreSQL_and_PGXS._Explain_Maven"></a>I know PostgreSQL and PGXS. Explain Maven!</h3>
<p>If Maven is unfamiliar, please see the &#x201c;Explain Maven!&#x201d; section on the <a href="build.html">main build page</a>, which covers most of the subject. However, there are some Windows-specific details:</p>

<ul>
  
<li>The Maven project has an extra page on <a class="externalLink" href="https://maven.apache.org/guides/getting-started/windows-prerequisites.html">Windows prerequisites</a>.</li>
  
<li>
<p>They don&#x2019;t very clearly document the location of your Maven settings file when running on Windows. If you want to change any Maven settings, it may be easiest to run</p>
  
<div class="source">
<div class="source">
<pre>mvn -X
</pre></div></div>
<p>and look for the lines</p>
  
<div class="source">
<div class="source">
<pre>[DEBUG] Reading global settings from (somewhere)/settings.xml
[DEBUG] Reading user settings from (somewhere)/settings.xml
</pre></div></div>
<p>to find and edit a settings file.</p></li>
</ul>
<p>A last reminder, <tt>mvn install</tt> does not add PL/Java as a language in your PostgreSQL database; the Maven <tt>install</tt> goal only adds things to your Maven repository. That isn&#x2019;t even necessary for installing the language in PostgreSQL, but it will be convenient when you <a href="../use/hello.html">build your Java projects that <i>use</i> PL/Java</a>.</p>
<p>To &#x201c;install&#x201d; your built PL/Java as a language in PostgreSQL, proceed to the <a href="../install/install.html">installation instructions</a>.</p></div>
<div class="section">
<h3><a name="I_know_Java_and_Maven._Explain_the_PostgreSQL_picture"></a>I know Java and Maven. Explain the PostgreSQL picture!</h3>
<p>The process of downloading and building PL/Java with Maven will be familiar to you, but the step saving artifacts into the local repository with the <tt>install</tt> goal is only a first step; PostgreSQL itself is not Maven-aware and will not find them there. After the <tt>mvn clean install</tt>, just proceed to the <a href="../install/install.html">installation instructions</a>.</p>
<p>The <tt>pljava-api</tt> subproject does benefit from being saved in your local Maven repository; you can then declare it like any other Maven dependency when <a href="../use/hello.html">building your own projects that <i>use</i> PL/Java</a>.</p></div>
<div class="section">
<h3><a name="Troubleshooting_the_build"></a>Troubleshooting the build</h3>
<p>If something fails, two tricks may be helpful. The C compilation may produce a lot of nuisance warnings, because the Maven plugin driving it enables many types of warning that would be impractical to fix. With many warnings it may be difficult to pick out messages that matter.</p>
<p>If the link step of the build reports that the symbol <tt>rint</tt> is undefined you are probably using an older version of Visual Studio (2010) with a newer version of Postgresql (9.4). This symbol is defined in Visual Studio 2013 and later and the Postgresql 9.4 headers lack the appropriate conditional options for the older compilers. You will need to use a newer version of Visual Studio.</p>
<p>On a machine with many cores, messages from several compilation threads may be intermingled in the output so that related messages are hard to identify. The option <tt>-Dnar.cores=1</tt> will force the messages into a sequential order (and has little effect on the speed of a PL/Java build).</p>
<p>The <tt>-X</tt> option will add a lot of information on the details of Maven&#x2019;s build activities.</p>

<div class="source">
<div class="source">
<pre>mvn  -X  -Dnar.cores=1  clean  install
</pre></div></div></div></div>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
              Copyright &#169;                    2003&#x2013;2015
                        <a href="http://tada.se/eng/">Tada AB</a>.
            All rights reserved.      
                    
                  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
