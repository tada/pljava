<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia Site Renderer 1.6 at 2015-12-19 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>PostgreSQL PL/Java &#x2013; Building PL/Java</title>
    <style type="text/css" media="all">
      @import url("../css/maven-base.css");
      @import url("../css/maven-theme.css");
      @import url("../css/site.css");
    </style>
    <link rel="stylesheet" href="../css/print.css" type="text/css" media="print" />
    <meta name="Date-Revision-yyyymmdd" content="20151219" />
    <meta http-equiv="Content-Language" content="en" />
        
        </head>
  <body class="composite">
    <div id="banner">
                        <a href="https://tada.github.io/pljava/" id="bannerLeft" title="PL/Java logo combining the PostgreSQL elephant and a Java bean">
                                                <img src="../images/pljava_logo.jpg" alt="PL/Java logo combining the PostgreSQL elephant and a Java bean" />
                </a>
                    <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
            
                    
                <div class="xleft">
        <span id="publishDate">Last Published: 2015-12-19</span>
                  &nbsp;| <span id="projectVersion">Version: 1.5.0-SNAPSHOT</span>
                      </div>
            <div class="xright">                    <a href="https://github.com/tada/pljava/wiki/" class="externalLink" title="Wiki">Wiki</a>
            |
                        <a href="https://github.com/tada/pljava/issues" class="externalLink" title="Issues">Issues</a>
            |
                        <a href="http://lists.pgfoundry.org/pipermail/pljava-dev/" class="externalLink" title="Mailing list">Mailing list</a>
            |
                        <a href="https://github.com/tada/pljava/tree/master/" class="externalLink" title="Code">Code</a>
              
                    
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
             
                    
                                <h5>Usage</h5>
                  <ul>
                  <li class="none">
            <strong>Building PL/Java</strong>
          </li>
                  <li class="none">
                          <a href="../install/install.html" title="Installing into PostgreSQL">Installing into PostgreSQL</a>
            </li>
                  <li class="none">
                          <a href="../use/use.html" title="User guide">User guide</a>
            </li>
          </ul>
                       <h5>Modules</h5>
                  <ul>
                  <li class="none">
                          <a href="../pljava-api/index.html" title="PL/Java API">PL/Java API</a>
            </li>
                  <li class="none">
                          <a href="../pljava/index.html" title="PL/Java backend Java code">PL/Java backend Java code</a>
            </li>
                  <li class="none">
                          <a href="../pljava-so/index.html" title="PL/Java backend native code">PL/Java backend native code</a>
            </li>
                  <li class="none">
                          <a href="../pljava-deploy/index.html" title="PL/Java Deploy">PL/Java Deploy</a>
            </li>
                  <li class="none">
                          <a href="../pljava-ant/index.html" title="PL/Java Ant tasks">PL/Java Ant tasks</a>
            </li>
                  <li class="none">
                          <a href="../pljava-examples/index.html" title="PL/Java examples">PL/Java examples</a>
            </li>
                  <li class="none">
                          <a href="../packaging/index.html" title="PL/Java packaging">PL/Java packaging</a>
            </li>
          </ul>
                       <h5>Project Documentation</h5>
                  <ul>
                                                                                                                                                                                                                                                                          <li class="collapsed">
                          <a href="../project-info.html" title="Project Information">Project Information</a>
                  </li>
          </ul>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="../images/logos/maven-feather.png" />
      </a>
                   
                    
            </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <h1>Building PL/Java</h1>
<p><b>For the impatient:</b></p>

<div class="source">
<div class="source">
<pre>mvn  clean  install
</pre></div></div>
<p>PL/Java is built using <a class="externalLink" href="https://maven.apache.org/">Apache Maven</a>. The above command will build it and produce the files you need, but <i>not</i> install them into PostgreSQL. To do that, continue with the <a href="../install/install.html">installation instructions</a>.</p>
<p>There are prerequisites, of course:</p>

<ol style="list-style-type: decimal">
  
<li>
<p>You need the C compiling and linking tools for your platform. On many platforms that means <tt>gcc</tt> and <tt>g++</tt>, and your normal search path should include them, which you can test with</p>
  
<div class="source">
<div class="source">
<pre>g++  --version
</pre></div></div>
<p>at the command line, which should tell you the version you have installed.</p></li>
  
<li>
<p>The <a class="externalLink" href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">Java Development Kit</a> (not just the Java Runtime Environment) version that you plan to use should be installed, also ideally in your search path so that</p>
  
<div class="source">
<div class="source">
<pre>javac  -version
</pre></div></div>
<p>just works.</p></li>
  
<li>
<p>The PostgreSQL server version that you intend to use should be installed, and on your search path so that the command</p>
  
<div class="source">
<div class="source">
<pre>pg_config
</pre></div></div>
<p>succeeds.</p></li>
  
<li>
<p>Development files (mostly <tt>.h</tt> files) for that PostgreSQL version must also be installed. To check, look in the output of that <tt>pg_config</tt> command for an <tt>INCLUDEDIR-SERVER</tt> line, and list the directory it refers to. There should be a bunch of <tt>*.h</tt> files there. If not, you probably installed PostgreSQL from a packaged distribution, and there is probably another package with a similar name but a suffix like <tt>-devel</tt> that needs to be installed to provide the <tt>.h</tt> files.</p></li>
  
<li>
<p>Naturally, <a class="externalLink" href="https://maven.apache.org/">Maven</a> needs to be installed. When it properly is,</p>
  
<div class="source">
<div class="source">
<pre>mvn --version
</pre></div></div>
<p>succeeds.</p></li>
</ol>
<p>If you have more than one version installed of PostgreSQL, Java, or the compile/link tools, make sure the ones found on your search path are the ones you plan to use, and the version-test commands above give the output you expect.</p>
<div class="section">
<h2><a name="Special_topics"></a>Special topics</h2>
<p>Please review any of the following that apply to your situation:</p>

<ul>
  
<li><a href="versions.html">Version compatibility</a></li>
  
<li>Building on Microsoft Windows: <a href="buildmsvc.html">with Visual Studio</a></li>
  
<li>Building on <a href="macosx.html">Mac OS X</a></li>
  
<li>Building on <a href="freebsd.html">FreeBSD</a></li>
</ul></div>
<div class="section">
<h2><a name="Obtaining_PLJava_sources"></a>Obtaining PL/Java sources</h2>
<p>The best way to obtain up-to-date PL/Java sources is to have <a class="externalLink" href="https://git-scm.com/">git</a> installed and <tt>clone</tt> the PL/Java GitHub repository, using either of these commands:</p>

<div class="source">
<div class="source">
<pre>git clone https://github.com/tada/pljava.git
git clone ssh://git@github.com/tada/pljava.git
</pre></div></div>
<p>The second only works if you have a GitHub account, but has the advantage of being faster if you do <tt>git pull</tt> later on to stay in sync with updated sources.</p></div>
<div class="section">
<h2><a name="The_build"></a>The build</h2>
<p>To start the build, your current directory should be the one the sources were checked out into. Looking around, there should be a <tt>pom.xml</tt> file there, and several subdirectories <tt>pljava</tt>, <tt>pljava-api</tt>, <tt>pljava-so</tt>, etc.</p>
<p>A successful <tt>mvn clean install</tt> should produce output like this near the end:</p>

<div class="source">
<div class="source">
<pre>[INFO] PostgreSQL PL/Java ................................ SUCCESS
[INFO] PL/Java API ....................................... SUCCESS
[INFO] PL/Java backend Java code ......................... SUCCESS
[INFO] PL/Java backend native code ....................... SUCCESS
[INFO] PL/Java Deploy .................................... SUCCESS
[INFO] PL/Java Ant tasks ................................. SUCCESS
[INFO] PL/Java examples .................................. SUCCESS
[INFO] PL/Java packaging ................................. SUCCESS
</pre></div></div>
<p>(the real output will include timings on each line). You will then be ready to <a href="../install/install.html">try out PL/Java in PostgreSQL</a>.</p>
<div class="section">
<h3><a name="I_know_PostgreSQL_and_PGXS._Explain_Maven"></a>I know PostgreSQL and PGXS. Explain Maven!</h3>
<p><a class="externalLink" href="https://maven.apache.org/">Maven</a> is a widely used tool for building and maintaining projects in Java. The <tt>pom.xml</tt> file contains the information Maven needs not only for building the project, but obtaining its dependencies and generating reports and documentation (including the web site you see here).</p>
<p>If this is your first use of Maven, your first <tt>mvn clean install</tt> command will do a lot of downloading, obtaining all of PL/Java&#x2019;s dependencies as declared in its <tt>pom.xml</tt> files, and those dependencies&#x2019; dependencies, etc. Most of the dependencies are the various Maven plugins used in the build, and the libraries they depend on.</p>
<p>Maven will create a local &#x201c;maven repository&#x201d; to store what it downloads, so your later <tt>mvn</tt> commands will complete much faster, with no downloading or only a few artifacts downloaded if versions have updated.</p>
<p>With default settings, Maven will create this local repository under your home directory. It will grow to contain artifacts you have built with Maven and all the artifacts downloaded as dependencies, which can be a large set, especially if you work on several different Maven-built projects requiring different versions of the same dependencies. (It may reach 50 MB after building only PL/Java.) If you would like Maven to create the local repository elsewhere, the <tt>&lt;localRepository&gt;</tt> element of your <a class="externalLink" href="https://maven.apache.org/settings.html">Maven settings</a> can specify a path.</p>
<p>It is thinkable to place the repository on storage that is not backed up, as it contains nothing that cannot be redownloaded or rebuilt from your sources.</p>
<div class="section">
<h4><a name="Why_does_mvn_clean_install_not_install_PLJava_into_PostgreSQL"></a>Why does <tt>mvn clean install</tt> not &#x201c;install&#x201d; PL/Java into PostgreSQL?</h4>
<p>The Maven goal called <tt>install</tt> has a meaning specific to Maven: it does not set up your newly-built PL/Java as a language in PostgreSQL. (Neither does the <tt>deploy</tt> goal, if you are wondering.)</p>
<p>What Maven&#x2019;s <tt>install</tt> does is save the newly-built artifact into the local repository, so other Maven-built projects can list it as a dependency. That is useful for the <tt>pljava-api</tt> subproject, so you can then easily <a href="../use/hello.html">build your Java projects that <i>use</i> PL/Java</a>.</p>
<p>To &#x201c;install&#x201d; your built PL/Java as a language in PostgreSQL, proceed to the <a href="../install/install.html">installation instructions</a>.</p></div></div>
<div class="section">
<h3><a name="I_know_Java_and_Maven._Explain_the_PostgreSQL_picture"></a>I know Java and Maven. Explain the PostgreSQL picture!</h3>
<p>The process of downloading and building PL/Java with Maven will be familiar to you, but the step saving artifacts into the local repository with the <tt>install</tt> goal is only a first step; PostgreSQL itself is not Maven-aware and will not find them there. After the <tt>mvn clean install</tt>, just proceed to the <a href="../install/install.html">installation instructions</a>.</p>
<p>The <tt>pljava-api</tt> subproject does benefit from being saved in your local Maven repository; you can then declare it like any other Maven dependency when <a href="../use/hello.html">building your own projects that <i>use</i> PL/Java</a>.</p></div>
<div class="section">
<h3><a name="Troubleshooting_the_build"></a>Troubleshooting the build</h3>
<p>If something fails, two tricks may be helpful. The C compilation may produce a lot of nuisance warnings, because the Maven plugin driving it enables many types of warning that would be impractical to fix. With many warnings it may be difficult to pick out messages that matter.</p>
<p>If the compiler is <tt>gcc</tt>, an extra option <tt>-Pwnosign</tt> can be given on the <tt>mvn</tt> command line, and will suppress the most voluminous and least useful warnings. It adds the compiler option <tt>-Wno-sign-conversion</tt> which might not be understood by other compilers, so may not have the intended effect if the compiler is not <tt>gcc</tt>.</p>
<p>On a machine with many cores, messages from several compilation threads may be intermingled in the output so that related messages are hard to identify. The option <tt>-Dnar.cores=1</tt> will force the messages into a sequential order (and has little effect on the speed of a PL/Java build).</p>
<p>The <tt>-X</tt> option will add a lot of information on the details of Maven&#x2019;s build activities.</p>

<div class="source">
<div class="source">
<pre>mvn  -X  -Pwnosign  -Dnar.cores=1  clean  install
</pre></div></div></div></div>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
              Copyright &#169;                    2003&#x2013;2015
                        <a href="http://tada.se/eng/">Tada AB</a>.
            All rights reserved.      
                    
                  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
