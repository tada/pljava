<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.11.1 from src/site/markdown/build/build.md at 2024-10-19

 | Rendered using Apache Maven Default Skin
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.11.1" />
    <title>PostgreSQL PL/Java &#x2013; Building PL/Java</title>
    <link rel="stylesheet" href="../css/maven-base.css" />
    <link rel="stylesheet" href="../css/maven-theme.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />
  </head>
  <body class="composite">
    <div id="banner">
<a href="https://tada.github.io/pljava/" id="bannerLeft" title="PL/Java logo combining the PostgreSQL elephant and a Java bean"><img src="../images/pljava_logo.jpg"  alt="PL/Java logo combining the PostgreSQL elephant and a Java bean"/></a>      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
      <div class="xleft">
        <span id="publishDate">Last Published: 2024-10-19</span>
           | <span id="projectVersion">Version: 1.6.8</span>
      </div>
      <div class="xright"><a href="https://github.com/tada/pljava/wiki/" class="externalLink" title="Wiki">Wiki</a> |
<a href="https://github.com/tada/pljava/issues" class="externalLink" title="Issues">Issues</a> |
<a href="https://www.postgresql.org/list/pljava-dev/" class="externalLink" title="Mailing list">Mailing list</a> |
<a href="https://github.com/tada/pljava/tree/master/" class="externalLink" title="Code">Code</a>      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
       <h5>Usage</h5>
    <ul>
     <li class="none"><strong>Building PL/Java</strong></li>
     <li class="none"><a href="../install/install.html" title="Installing into PostgreSQL">Installing into PostgreSQL</a></li>
     <li class="none"><a href="../install/upgrade.html" title="Upgrading">Upgrading</a></li>
     <li class="none"><a href="../build/package.html" title="Packaging PL/Java">Packaging PL/Java</a></li>
     <li class="none"><a href="../use/use.html" title="User guide">User guide</a></li>
     <li class="none"><a href="../develop/develop.html" title="Developer notes">Developer notes</a></li>
    </ul>
       <h5>Release Information</h5>
    <ul>
     <li class="none"><a href="../releasenotes.html" title="Release notes">Release notes</a></li>
    </ul>
       <h5>Modules</h5>
    <ul>
     <li class="none"><a href="../pljava-api/index.html" title="PL/Java API">PL/Java API</a></li>
     <li class="none"><a href="../pljava/index.html" title="PL/Java backend Java code">PL/Java backend Java code</a></li>
     <li class="none"><a href="../pljava-so/index.html" title="PL/Java backend native code">PL/Java backend native code</a></li>
     <li class="none"><a href="../pljava-ant/index.html" title="PL/Java Ant tasks">PL/Java Ant tasks</a></li>
     <li class="none"><a href="../pljava-examples/index.html" title="PL/Java examples">PL/Java examples</a></li>
     <li class="none"><a href="../pljava-packaging/index.html" title="PL/Java packaging">PL/Java packaging</a></li>
     <li class="none"><a href="../pljava-pgxs/index.html" title="PL/Java PGXS">PL/Java PGXS</a></li>
    </ul>
       <h5>Project Documentation</h5>
    <ul>
     <li class="collapsed"><a href="../project-info.html" title="Project Information">Project Information</a></li>
    </ul>
      <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="../images/logos/maven-feather.png" />
      </a>
      </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
<h1>Building PL/Java</h1>
<p><b>For the impatient:</b></p>

<div class="source">
<pre><code>mvn  clean  install
</code></pre></div>
<p>PL/Java is built using <a class="externalLink" href="https://maven.apache.org/">Apache Maven</a>. The above command will build it
and produce the files you need, but <i>not</i> install them into PostgreSQL.
To do that, continue with the <a href="../install/install.html">installation instructions</a>.</p>
<p><b>In case of build difficulties:</b></p>
<p>There is a &#x201c;troubleshooting the build&#x201d; section at the end of this page.</p><section>
<h2><a name="Software_Prerequisites"></a>Software Prerequisites</h2>
<ol style="list-style-type: decimal">

<li>

<p>You need the C compiling and linking tools for your platform.
On many platforms that means <code>gcc</code> and <code>g++</code>, and your normal search
path should include them, which you can test with</p>

<div class="source">
<pre><code> g++  --version
</code></pre></div>
<p>at the command line, which should tell you the version you have installed.</p>
</li>
<li>

<p>The Java Development Kit (not just the Java Runtime Environment)
version that you plan to use should be installed, also ideally in your
search path so that</p>

<div class="source">
<pre><code> javac  -version
</code></pre></div>
<p>just works. PL/Java can be built with <a class="externalLink" href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">Oracle Java</a> or <a class="externalLink" href="https://adoptopenjdk.net/">OpenJDK</a>,
the latter with <a class="externalLink" href="https://www.eclipse.org/openj9/oj9_faq.html">either the Hotspot or the OpenJ9 JVM</a>, or with
<a class="externalLink" href="https://www.graalvm.org/downloads/">GraalVM</a>. It is not necessary to use the same JDK to build PL/Java that
will later be used to run it in the database, and PL/Java applications can
generally take advantage of recent features in whatever Java version is
used at run time. (See more on <a href="versions.html">version compatibility</a>.)</p>
</li>
<li>

<p>The PostgreSQL server version that you intend to use should be installed,
and on your search path so that the command</p>

<div class="source">
<pre><code> pg_config
</code></pre></div>
<p>succeeds.</p>
</li>
<li>

<p>Development files (mostly <code>.h</code> files) for that PostgreSQL version must also
be installed. To check, look in the output of that <code>pg_config</code> command for
an <code>INCLUDEDIR-SERVER</code> line, and list the directory it refers to. There
should be a bunch of <code>*.h</code> files there. If not, you probably installed
PostgreSQL from a packaged distribution, and there is probably another
package with a similar name but a suffix like <code>-devel</code> that needs to be
installed to provide the <code>.h</code> files.</p>
</li>
<li>

<p>Naturally, <a class="externalLink" href="https://maven.apache.org/">Maven</a> needs to be installed. When it properly is,</p>

<div class="source">
<pre><code> mvn --version
</code></pre></div>
<p>succeeds. It reports not only the version of Maven, but the version of Java
that Maven has found and is using, which must be a Java version supported
for building PL/Java (see more on <a href="versions.html">version compatibility</a>).
If Maven is not finding and using the intended Java version, the environment
variable <code>JAVA_HOME</code> can be set to point to the desired Java installation,
and <code>mvn --version</code> should then confirm that the Java being found is the
one intended.</p>
</li>
</ol>
<p>If you have more than one version installed of PostgreSQL, Java, or the
compile/link tools, make sure the ones found on your search path are the
ones you plan to use, and the version-test commands above give the output
you expect.</p></section><section>
<h2><a name="Special_topics"></a>Special topics</h2>
<p>Please review any of the following that apply to your situation:</p>
<ul>

<li><a href="versions.html">Version compatibility</a></li>
<li>Building on <a href="freebsd.html">FreeBSD</a></li>
<li>Building on <a href="macosx.html">Mac OS X</a></li>
<li>Building on <a href="solaris.html">Solaris</a></li>
<li>Building on <a href="ubuntu.html">Ubuntu</a></li>
<li>Building on <a href="ppc64le-linux-gpp.html">Linux <code>ppc64le</code></a></li>
<li>Building on Microsoft Windows: <a href="buildmsvc.html">with Visual Studio</a>
| <a href="mingw64.html">with MinGW-w64</a></li>
<li>Building on an EnterpriseDB PostgreSQL distribution that bundles system
libraries, or other situations where
<a href="runpath.html">a linker runpath</a> can help</li>
<li>Building if you are
<a href="package.html">making a package for a software distribution</a></li>
<li>Building <a href="debugopt.html">with debugging or optimization options</a></li>
</ul></section><section>
<h2><a name="Obtaining_PL.2FJava_sources"></a>Obtaining PL/Java sources</h2><section>
<h3><a name="Sources_for_a_specific_release"></a>Sources for a specific release</h3>
<p>Obtain source for a specific PL/Java release from the
<a class="externalLink" href="https://github.com/tada/pljava/releases">Releases page on GitHub</a>, archived in your choice of <code>zip</code> or <code>tar.gz</code>
format.</p>
<p>If you have <code>git</code>, you can also obtain specific-release source by cloning
the repository and checking out the tag that identifies the release.</p></section><section>
<h3><a name="Current_development_sources"></a>Current development sources</h3>
<p>The best way to obtain up-to-date development PL/Java sources is to have
<a class="externalLink" href="https://git-scm.com/">git</a> installed and <code>clone</code> the PL/Java GitHub repository, using either of
these commands:</p>

<div class="source">
<pre><code>git clone https://github.com/tada/pljava.git
git clone ssh://git@github.com/tada/pljava.git
</code></pre></div>
<p>The second only works if you have a GitHub account, but has the advantage
of being faster if you do <code>git pull</code> later on to stay in sync with updated
sources.</p>
<p>From a clone, you can also build specific released versions, by first
using <code>git checkout</code> with the tag that identifies the release.</p>
<p>Building from unreleased, development sources will be of most interest when
hacking on PL/Java itself. The GitHub &#x201c;Branches&#x201d; page can be used to see which
branch has had the most recent development activity (this will not always be
the branch named <code>master</code>; periods of development can be focused on the branch
corresponding to current releases).</p></section></section><section>
<h2><a name="The_build"></a>The build</h2>
<p>To start the build, your current directory should be the one the sources were
checked out into. Looking around, there should be a <code>pom.xml</code> file there, and
several subdirectories <code>pljava</code>, <code>pljava-api</code>, <code>pljava-so</code>, etc.</p>
<p>A successful <code>mvn clean install</code> should produce output like this near the end:</p>

<div class="source">
<pre><code>[INFO] PostgreSQL PL/Java ................................ SUCCESS
[INFO] PL/Java API ....................................... SUCCESS
[INFO] PL/Java backend Java code ......................... SUCCESS
[INFO] PL/Java backend native code ....................... SUCCESS
[INFO] PL/Java Deploy .................................... SUCCESS
[INFO] PL/Java Ant tasks ................................. SUCCESS
[INFO] PL/Java examples .................................. SUCCESS
[INFO] PL/Java packaging ................................. SUCCESS
</code></pre></div>
<p>(the real output will include timings on each line). You will then be ready
to <a href="../install/install.html">try out PL/Java in PostgreSQL</a>.</p><section>
<h3><a name="PostgreSQL_version_to_build_against"></a>PostgreSQL version to build against</h3>
<p>If several versions of PostgreSQL are installed on the build host, select
the one to be built for by adding the full path of its <code>pg_config</code> executable
with <code>-Dpgsql.pgconfig=</code> on the <code>mvn</code> command line.</p></section><section>
<h3><a name="I_know_PostgreSQL_and_PGXS._Explain_Maven.21"></a>I know PostgreSQL and PGXS. Explain Maven!</h3>
<p><a class="externalLink" href="https://maven.apache.org/">Maven</a> is a widely used tool for building and maintaining projects in
Java. The <code>pom.xml</code> file contains the information Maven needs not only for
building the project, but obtaining its dependencies and generating reports
and documentation (including the web site you see here).</p>
<p>If this is your first use of Maven, your first <code>mvn clean install</code> command will
do a lot of downloading, obtaining all of PL/Java's dependencies as declared in
its <code>pom.xml</code> files, and those dependencies' dependencies, etc. Most of the
dependencies are the various Maven plugins used in the build, and the libraries
they depend on.</p>
<p>Maven will create a local &#x201c;maven repository&#x201d; to store what it downloads, so
your later <code>mvn</code> commands will complete much faster, with no downloading or
only a few artifacts downloaded if versions have updated.</p>
<p>With default settings, Maven will create this local repository under your home
directory. It will grow to contain artifacts you have built with Maven and all
the artifacts downloaded as dependencies, which can be a large set, especially
if you work on several different Maven-built projects requiring different
versions of the same dependencies. (It may reach 50 MB after building only
PL/Java.) If you would like Maven to create the local repository elsewhere,
the <code>&lt;localRepository&gt;</code> element of your <a class="externalLink" href="https://maven.apache.org/settings.html">Maven settings</a> can specify
a path.</p>
<p>It is thinkable to place the repository on storage that is not backed up, as
it contains nothing that cannot be redownloaded or rebuilt from your sources.</p><section>
<h4><a name="Why_does_mvn_clean_install_not_.E2.80.9Cinstall.E2.80.9D_PL.2FJava_into_PostgreSQL.3F"></a>Why does <code>mvn clean install</code> not &#x201c;install&#x201d; PL/Java into PostgreSQL?</h4>
<p>The Maven goal called <code>install</code> has a meaning specific to Maven:
it does not set up your newly-built PL/Java as a
language in PostgreSQL. (Neither does the <code>deploy</code> goal, if you are wondering.)</p>
<p>What Maven's <code>install</code> does is save the newly-built artifact into the local
repository, so other Maven-built projects can list it as a dependency. That
is useful for the <code>pljava-api</code> subproject, so you can then easily
<a href="../use/hello.html">build your Java projects that <i>use</i> PL/Java</a>.</p>
<p>To &#x201c;install&#x201d; your built PL/Java as a language in PostgreSQL, proceed to
the <a href="../install/install.html">installation instructions</a>.</p></section></section><section>
<h3><a name="I_know_Java_and_Maven._Explain_the_PostgreSQL_picture.21"></a>I know Java and Maven. Explain the PostgreSQL picture!</h3>
<p>The process of downloading and building PL/Java with Maven will be familiar
to you, but the step saving artifacts into the local repository with the
<code>install</code> goal is only a first step; PostgreSQL itself
is not Maven-aware and will not find them there. After the
<code>mvn clean install</code>, just proceed to the <a href="../install/install.html">installation instructions</a>.</p>
<p>The <code>pljava-api</code> subproject does benefit from being saved in your local
Maven repository; you can then declare it like any other Maven
dependency when <a href="../use/hello.html">building your own projects that <i>use</i> PL/Java</a>.</p></section><section>
<h3><a name="Troubleshooting_the_build"></a>Troubleshooting the build</h3>
<p><i>Note: in addition to this section, there is a <a class="externalLink" href="https://github.com/tada/pljava/wiki/Build-tips">build tips wiki page</a>,
which may be updated between releases of this document to collect tips for
build issues that are commonly asked about.</i></p><section>
<h4><a name="Capture_the_output_of_mvn_-X"></a>Capture the output of <code>mvn -X</code></h4>
<p>The <code>-X</code> option will add a lot of information on the details of Maven's
build activities.</p>

<div class="source">
<pre><code>mvn  -X  clean  install
</code></pre></div></section><section>
<h4><a name="Avoid_capturing_the_first_run_of_Maven"></a>Avoid capturing the first run of Maven</h4>
<p>On the first run, Maven will produce a lot of output while downloading all
of the dependencies needed to complete the build. It is better, if the build
fails, to simply run Maven again and capture the output of that run, which
will not include all of the downloading activity.</p>
<p>As an alternative, the flood of messages reflecting successful dependency
downloads in a first run can be suppressed by adding this option on the <code>mvn</code>
command line:</p>

<div class="source">
<pre><code>-Dorg.slf4j.simpleLogger.log.org.apache.maven.cli.transfer.Slf4jMavenTransferListener=warn
</code></pre></div></section></section></section>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
        Copyright &#169;      2003&#x2013;2024<a href="http://tada.se/eng/">Tada AB</a>.
.      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
