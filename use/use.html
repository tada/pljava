<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.11.1 from src/site/markdown/use/use.md at 2025-03-23

 | Rendered using Apache Maven Default Skin
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.11.1" />
    <title>PostgreSQL PL/Java &#x2013; User guide (non-wiki version)</title>
    <link rel="stylesheet" href="../css/maven-base.css" />
    <link rel="stylesheet" href="../css/maven-theme.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />
  </head>
  <body class="composite">
    <div id="banner">
<a href="https://tada.github.io/pljava/" id="bannerLeft" title="PL/Java logo combining the PostgreSQL elephant and a Java bean"><img src="../images/pljava_logo.jpg"  alt="PL/Java logo combining the PostgreSQL elephant and a Java bean"/></a>      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
      <div class="xleft">
        <span id="publishDate">Last Published: 2025-03-23</span>
           | <span id="projectVersion">Version: 1.6.9</span>
      </div>
      <div class="xright"><a href="https://github.com/tada/pljava/wiki/" class="externalLink" title="Wiki">Wiki</a> |
<a href="https://github.com/tada/pljava/issues" class="externalLink" title="Issues">Issues</a> |
<a href="https://www.postgresql.org/list/pljava-dev/" class="externalLink" title="Mailing list">Mailing list</a> |
<a href="https://github.com/tada/pljava/tree/master/" class="externalLink" title="Code">Code</a>      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
       <h5>Usage</h5>
    <ul>
     <li class="none"><a href="../build/build.html" title="Building PL/Java">Building PL/Java</a></li>
     <li class="none"><a href="../install/install.html" title="Installing into PostgreSQL">Installing into PostgreSQL</a></li>
     <li class="none"><a href="../install/upgrade.html" title="Upgrading">Upgrading</a></li>
     <li class="none"><a href="../build/package.html" title="Packaging PL/Java">Packaging PL/Java</a></li>
     <li class="none"><strong>User guide</strong></li>
     <li class="none"><a href="../develop/develop.html" title="Developer notes">Developer notes</a></li>
    </ul>
       <h5>Release Information</h5>
    <ul>
     <li class="none"><a href="../releasenotes.html" title="Release notes">Release notes</a></li>
    </ul>
       <h5>Modules</h5>
    <ul>
     <li class="none"><a href="../pljava-api/index.html" title="PL/Java API">PL/Java API</a></li>
     <li class="none"><a href="../pljava/index.html" title="PL/Java backend Java code">PL/Java backend Java code</a></li>
     <li class="none"><a href="../pljava-so/index.html" title="PL/Java backend native code">PL/Java backend native code</a></li>
     <li class="none"><a href="../pljava-ant/index.html" title="PL/Java Ant tasks">PL/Java Ant tasks</a></li>
     <li class="none"><a href="../pljava-examples/index.html" title="PL/Java examples">PL/Java examples</a></li>
     <li class="none"><a href="../pljava-packaging/index.html" title="PL/Java packaging">PL/Java packaging</a></li>
     <li class="none"><a href="../pljava-pgxs/index.html" title="PL/Java PGXS">PL/Java PGXS</a></li>
    </ul>
       <h5>Project Documentation</h5>
    <ul>
     <li class="collapsed"><a href="../project-info.html" title="Project Information">Project Information</a></li>
    </ul>
      <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="../images/logos/maven-feather.png" />
      </a>
      </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
<h1>User guide (non-wiki version)</h1>
<p>Content will gradually be migrated here and updated from the
<a class="externalLink" href="https://github.com/tada/pljava/wiki/User-guide">user guide pages on the wiki</a>.</p>
<p>For now, this only suggests a few sources:</p>
<ul>

<li>The obligatory <a href="hello.html">Hello world</a> tutorial example</li>
<li>The <a href="../pljava-api/apidocs/org.postgresql.pljava/org/postgresql/pljava/package-summary.html#package-description">PL/Java API</a> documentation</li>
<li>The user guide pages <a class="externalLink" href="https://github.com/tada/pljava/wiki/User-guide">on the wiki</a></li>
<li>The many pre-built <a href="../examples/examples.html">examples</a></li>
</ul><section>
<h2><a name="How_to_compile_against_the_PL.2FJava_API"></a>How to compile against the PL/Java API</h2>
<p>The <a href="hello.html">Hello world example</a> demonstrates how to use a Maven POM
that declares <code>pljava-api</code> as a dependency. However, as arrangements
are still incomplete for <code>pljava-api</code> to be at Maven Central, it has
to be in your local Maven repository. If you have built PL/Java from
source using <code>mvn clean install</code>, it will be there already.</p>
<p>If not, an easy way to install the API into your local repository
is to download the PL/Java source, and run
<code>mvn --projects pljava-api clean install</code> there. It will quickly build
and install the API jar, without requiring the various build-time
dependencies needed when all of PL/Java is being built.</p>
<p>If not using Maven, you can simply add the <code>pljava-api</code> jar file to the
class path for your Java compiler. Installation normally places the file
in <code>SHAREDIR/pljava</code> where <code>SHAREDIR</code> is as reported by <code>pg_config</code>.</p></section><section>
<h2><a name="PL.2FJava_configuration_variables"></a>PL/Java configuration variables</h2>
<p>Several <a href="variables.html">configuration variables</a> can affect PL/Java's
operation, including some common PostgreSQL variables as well as
PL/Java's own.</p><section>
<h3><a name="Enabling_additional_Java_modules"></a>Enabling additional Java modules</h3>
<p>By default, PL/Java code can see a small set of Java modules, including
<code>java.base</code> and <code>java.sql</code> and a few others. To include others, use
<a href="../install/vmoptions.html#Adding_to_the_set_of_readable_modules"><code>--add-modules</code> in <code>pljava.vmoptions</code></a>.</p></section></section><section>
<h2><a name="Special_topics"></a>Special topics</h2><section>
<h3><a name="Configuring_permissions"></a>Configuring permissions</h3>
<p>When PL/Java is used with Java 23 or earlier, the permissions in effect
for PL/Java functions can be tailored, independently for functions declared to
the <code>TRUSTED</code> or untrusted language, as described <a href="policy.html">here</a>.</p>
<p>When PL/Java is used with stock Java 24 or later, no such tailoring of
permissions is possible, and the
<a href="unenforced.html">PL/Java with no policy enforcement</a> page should be carefully
reviewed.</p><section>
<h4><a name="Tailoring_permissions_for_code_migrated_from_PL.2FJava_pre-1.6"></a>Tailoring permissions for code migrated from PL/Java pre-1.6</h4>
<p>When migrating existing code from a PL/Java 1.5 or earlier release to 1.6,
it may be necessary to add permission grants in the new <code>pljava.policy</code> file,
which grants few permissions by default. To simplify migration, it is possible
to run with a &#x2018;trial&#x2019; policy initially, allowing code to run but logging
permissions that may need to be added in <code>pljava.policy</code>. How to do that is
described <a href="trial.html">here</a>.</p></section></section><section>
<h3><a name="Debugging_PL.2FJava_functions"></a>Debugging PL/Java functions</h3><section>
<h4><a name="Java_exception_stack_traces"></a>Java exception stack traces</h4>
<p>PL/Java catches any Java exceptions uncaught by your Java code, and passes them
on as familiar PostgreSQL errors that will be reported to the client, or can be
caught, as with PL/pgSQL's <code>EXCEPTION</code> clause. However, the created PostgreSQL
error does not include the stack trace of the original Java exception.</p>
<p>If either of the PostgreSQL settings <code>client_min_messages</code> or <code>log_min_messages</code>
is <code>DEBUG1</code> or finer, the Java exception stack trace will be printed to
the standard error channel of the backend process, where it will be collected
and saved in the server log if the PostgreSQL setting <code>logging_collector</code> is on.
Otherwise, it will go wherever the error channel of the backend process is
directed, possibly nowhere.</p></section><section>
<h4><a name="Connecting_a_debugger"></a>Connecting a debugger</h4>
<p>To allow connecting a Java debugger, the PostgreSQL setting <code>pljava.vmoptions</code>
can be changed, in a particular session, to contain a string like:</p>

<div class="source">
<pre><code>-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=localhost:0
</code></pre></div>
<p>On the first action in that session that uses PL/Java, the debugger transport
will be set up as specified. For the example above, PL/Java will listen for
a connection from a Java debugger at a randomly-chosen port, which will be
identified with this message (where <i>nnnnn</i> is the port number):</p>

<div class="source">
<pre><code>Listening for transport dt_socket at address: nnnnn
</code></pre></div>
<p>A Java debugger can then be started and attached to the listening address and
port.</p>
<p>The &#x201c;Listening&#x201d; message, however, is written to the standard output channel
of the PostgreSQL backend process. It may be immediately visible if you are
running PostgreSQL in a <a href="../develop/node.html">test harness</a>, but in a
production setting it may go nowhere. In such a setting, you may prefer to set
a specific port number, rather than 0, in the <code>pljava.vmoptions</code> setting, to
be sure of the port the debugger should attach to. Choosing a port that is not
already in use is then up to you.</p>
<p>As an alternative, <code>server=y</code> can be changed to <code>server=n</code>, and PL/Java will
then attempt to attach to an already-listening debugger process. The
address:port should be adjusted to reflect where the debugger process is
listening.</p>
<p>With <code>suspend=n</code>, PL/Java proceeds normally without waiting for the debugger
connection, but the debugger will be able to set break or watch points, and will
have control when Java exceptions are thrown. With <code>suspend=y</code>, PL/Java only
proceeds once the debugger is connected and in control. This setting is more
commonly used for debugging PL/Java itself.</p></section></section><section>
<h3><a name="The_thread_context_class_loader"></a>The thread context class loader</h3>
<p>Starting with PL/Java 1.6.3, within an SQL-declared PL/Java function, the
class loader returned by <code>Thread.currentThread().getContextClassLoader</code>
is the one that corresponds to the per-schema classpath that has been set
with <a href="../pljava/apidocs/org.postgresql.pljava.internal/org/postgresql/pljava/management/Commands.html#set_classpath"><code>SQLJ.SET_CLASSPATH</code></a> for the schema where the function is
declared (assuming no Java code uses <code>setContextClassLoader</code> to change it).</p>
<p>Many available Java libraries, as well as built-in Java facilities using the
<a class="externalLink" href="https://docs.oracle.com/javase/9/docs/api/java/util/ServiceLoader.html"><code>ServiceLoader</code></a>, refer to the context class loader, so this behavior
ensures they will see the classes that are available on the classpath that was
set up for the PL/Java function. In versions where PL/Java did not set the
context loader, awkward arrangements could be needed in user code for the
desired classes or services to be found.</p>
<p>There are some limits on the implementation, and some applications may want
the former behavior where PL/Java did not touch the thread context loader.
More details are available <a href="../develop/contextloader.html">here</a>.</p></section><section>
<h3><a name="Choices_when_mapping_data_types"></a>Choices when mapping data types</h3><section>
<h4><a name="Date_and_time_types"></a>Date and time types</h4>
<p>PostgreSQL <code>date</code>, <code>time</code>, and <code>timestamp</code> types can still be matched to the
original JDBC <code>java.sql.Date</code>, <code>java.sql.Time</code>, and <code>java.sql.Timestamp</code>,
but application code is encouraged to move to Java 8 or later and use the
<a href="datetime.html">new classes in the <code>java.time</code> package in Java 8</a> instead.</p></section><section>
<h4><a name="XML_type"></a>XML type</h4>
<p>PL/Java can map PostgreSQL <code>xml</code> data to <code>java.lang.String</code>, but there are
significant advantages to using the
<a href="sqlxml.html">JDBC 4.0 <code>java.sql.SQLXML</code> type</a> for processing XML.</p></section></section><section>
<h3><a name="Parallel_query"></a>Parallel query</h3>
<p>PL/Java understands <a class="externalLink" href="https://www.postgresql.org/docs/current/static/bgworker.html">background worker processes</a>
in PostgreSQL 9.5 and later,
and PostgreSQL 9.6 introduced <a class="externalLink" href="https://www.postgresql.org/docs/current/static/parallel-query.html">parallel query</a>.</p>
<p>For details on PL/Java in a background worker or parallel query, see
<a href="parallel.html">PL/Java in parallel query</a>.</p></section><section>
<h3><a name="Character-set_encodings"></a>Character-set encodings</h3>
<p>PL/Java will work most seamlessly when the server encoding in PostgreSQL is
<code>UTF8</code>. For other cases, please see the <a href="charsets.html">character encoding notes</a>.</p></section><section>
<h3><a name="Byte-order_issues"></a>Byte-order issues</h3>
<p>PL/Java is free of byte-order issues except when using its features for building
user-defined types in Java. At sites with no current or planned use of
those features, this section does not require attention.</p>
<p>The 1.5.0 release of PL/Java begins a transition affecting the byte-order
defaults, which will be completed in a future release. No immediate action is
recommended; there is a <a href="byteorder.html">byte-order page</a> for more on the topic
and an advance notice of an expected future migration step.</p></section></section>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
        Copyright &#169;      2003&#x2013;2025<a href="http://tada.se/eng/">Tada AB</a>.
.      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
