<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.11.1 from src/site/markdown/use/jpms.md at 2024-10-19

 | Rendered using Apache Maven Default Skin
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.11.1" />
    <title>PostgreSQL PL/Java &#x2013; PL/Java and the Java Platform Module System</title>
    <link rel="stylesheet" href="../css/maven-base.css" />
    <link rel="stylesheet" href="../css/maven-theme.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />
  </head>
  <body class="composite">
    <div id="banner">
<a href="https://tada.github.io/pljava/" id="bannerLeft" title="PL/Java logo combining the PostgreSQL elephant and a Java bean"><img src="../images/pljava_logo.jpg"  alt="PL/Java logo combining the PostgreSQL elephant and a Java bean"/></a>      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
      <div class="xleft">
        <span id="publishDate">Last Published: 2024-10-19</span>
           | <span id="projectVersion">Version: 1.6.8</span>
      </div>
      <div class="xright"><a href="https://github.com/tada/pljava/wiki/" class="externalLink" title="Wiki">Wiki</a> |
<a href="https://github.com/tada/pljava/issues" class="externalLink" title="Issues">Issues</a> |
<a href="https://www.postgresql.org/list/pljava-dev/" class="externalLink" title="Mailing list">Mailing list</a> |
<a href="https://github.com/tada/pljava/tree/master/" class="externalLink" title="Code">Code</a>      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
       <h5>Usage</h5>
    <ul>
     <li class="none"><a href="../build/build.html" title="Building PL/Java">Building PL/Java</a></li>
     <li class="none"><a href="../install/install.html" title="Installing into PostgreSQL">Installing into PostgreSQL</a></li>
     <li class="none"><a href="../install/upgrade.html" title="Upgrading">Upgrading</a></li>
     <li class="none"><a href="../build/package.html" title="Packaging PL/Java">Packaging PL/Java</a></li>
     <li class="none"><a href="../use/use.html" title="User guide">User guide</a></li>
     <li class="none"><a href="../develop/develop.html" title="Developer notes">Developer notes</a></li>
    </ul>
       <h5>Release Information</h5>
    <ul>
     <li class="none"><a href="../releasenotes.html" title="Release notes">Release notes</a></li>
    </ul>
       <h5>Modules</h5>
    <ul>
     <li class="none"><a href="../pljava-api/index.html" title="PL/Java API">PL/Java API</a></li>
     <li class="none"><a href="../pljava/index.html" title="PL/Java backend Java code">PL/Java backend Java code</a></li>
     <li class="none"><a href="../pljava-so/index.html" title="PL/Java backend native code">PL/Java backend native code</a></li>
     <li class="none"><a href="../pljava-ant/index.html" title="PL/Java Ant tasks">PL/Java Ant tasks</a></li>
     <li class="none"><a href="../pljava-examples/index.html" title="PL/Java examples">PL/Java examples</a></li>
     <li class="none"><a href="../pljava-packaging/index.html" title="PL/Java packaging">PL/Java packaging</a></li>
     <li class="none"><a href="../pljava-pgxs/index.html" title="PL/Java PGXS">PL/Java PGXS</a></li>
    </ul>
       <h5>Project Documentation</h5>
    <ul>
     <li class="collapsed"><a href="../project-info.html" title="Project Information">Project Information</a></li>
    </ul>
      <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="../images/logos/maven-feather.png" />
      </a>
      </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
<h1>PL/Java and the Java Platform Module System</h1>
<p>Java 9 introduced the <a class="externalLink" href="https://cr.openjdk.java.net/~mr/jigsaw/spec/">Java Platform Module System</a> (JPMS), allowing
Java code to be strongly encapsulated into modules that declare their
dependency relationships to other modules explicitly.</p>
<p>One consequence is that where a pre-Java-9 Java runtime would have
a &#x201c;class path&#x201d;, a Java-9-or-later runtime has a &#x201c;module path&#x201d; as well as
a legacy class path.</p>
<p>Pre-1.6.0 releases of PL/Java were not modularized, and can be used on
older Java runtimes. They will also run on Java 9 and later, but still only
as non-modular code. The Java runtime is launched with a class path that
includes a PL/Java jar and usually nothing else. That single jar includes
both API and implementation classes.</p>
<p>PL/Java 1.6.0 or later is structured as an API module (named
<code>org.postgresql.pljava</code>) and an implementation module (named
<code>org.postgresql.pljava.internal</code>) supplied in two distinct jar files.
The Java runtime is launched with a <i>module path</i>, not a class path,
that names both the implementation and the API jar, and usually nothing else.
For a class path, the runtime is launched by default with none at all.</p>
<p>User code developed to run in PL/Java is normally installed via SQL
calling the <code>sqlj.install_jar</code> and <code>sqlj.set_classpath</code> functions, and these
mechanisms are independent of the Java runtime's class path at launch.</p>
<p>In Java 9 and later, both a module path and a class path are supported so that
newer, modularized code and legacy, non-modular code can interoperate, and
legacy code can be migrated over time:</p>
<ul>

<li>

<p>A jar file that embodies an explicit named module should be placed on
the module path. It participates fully in the Java module system, and
its access to other modules will be determined by its explicit
<code>requires</code>/<code>exports</code>/<code>uses</code>/<code>provides</code>/<code>opens</code> relationships.</p>
</li>
<li>

<p>A jar file containing legacy, non-modular code should be placed on the
class path, and is treated as part of an unnamed module that has access
to the exports and opens of all other <i>readable</i> modules. Such code will,
therefore, continue to work as it did before Java 9, provided the needed
modules are <i>readable</i>, as explained below. (Even a jar containing Java 9+
modular code will be treated this way, if found on the class path rather
than the module path.)</p>
</li>
<li>

<p>A jar file can be placed on the module path even if it does not contain
an explicit named module. In that case, it becomes an &#x201c;automatic&#x201d; module,
with a name derived from the jar file name, or a better name can be
specified in its manifest. It will continue to have access to the
exports of any other modules, like an unnamed module, but other modules
will be able to declare dependencies on it by name. This can be a useful
intermediate step in migrating legacy code to modules.</p>
</li>
</ul>
<p>As of PL/Java 1.6, while PL/Java's own implementation is modularized, it
implements a version of the ISO SQL Java Routines and Types specification
that does not include Java module system concepts. Its <code>sqlj.set_classpath</code>
function manipulates an internal class path, not a module path, and a jar
installed with <code>sqlj.install_jar</code> behaves as legacy code in an unnamed module.</p><section>
<h2><a name="Readable_versus_observable_modules"></a>Readable versus observable modules</h2>
<p>Using Java's terminology, modules that can be found on the module path are
<i>observable</i>. Not all of those are automatically <i>readable</i>; the <i>readable</i>
ones in a JVM instance are initially those encountered, at JVM start-up, in
the &#x201c;recursive enumeration&#x201d; step of <a class="externalLink" href="https://docs.oracle.com/javase/9/docs/api/java/lang/module/package-summary.html#resolution">module resolution</a>.</p>
<p>Recursive enumeration begins with some root modules, and proceeds until all of
the modules on which they (transitively) depend have been added to the readable
set. When PL/Java is launched in a session, PL/Java's own module is a root,
and so the readable modules will include those PL/Java itself depends on,
such as <code>java.base</code>, <code>java.sql</code>, and the other modules <code>java.sql</code> names with
<code>requires transitive</code> directives.</p>
<p>Those modules may be enough for many uses of PL/Java. However, if code for use
in PL/Java will refer to other modules,
<a href="../install/vmoptions.html#Adding_to_the_set_of_readable_modules"><code>--add-modules</code> in <code>pljava.vmoptions</code></a> can be used to add more roots.
Because of recursive enumeration, it is enough to add just one module, or a few
modules, whose dependencies recursively cover whatever modules will be needed.</p>
<p>At one extreme for convenience, Java provides a module, <code>java.se</code>, that simply
declares dependencies on the other modules that make up the full Java SE API.
Therefore, <code>--add-modules=java.se</code> will ensure that any PL/Java code is able to
refer to any of the Java SE API. However, PL/Java instances may use less memory
and start up more quickly if an effort is made to add only modules actually
needed.</p></section><section>
<h2><a name="Configuring_the_launch-time_module_path"></a>Configuring the launch-time module path</h2>
<p>The configuration variable <code>pljava.module_path</code> controls the
module path used to launch the Java runtime. Its default is constructed to
include the expected locations of PL/Java's own implementation and API jars,
and nothing else, so there is typically no need to set it explicitly
unless those jars have been installed at unusual locations.
Its syntax is simply the pathnames of the jar files, separated by the
correct path separator character for the platform (often a colon, or a
semicolon on Windows).</p>
<p>There may at times be a reason to place additional modular jars on this
module path. Whenever it is explicitly set, it must still include the
correct locations of the PL/Java implementation and API jars.</p></section><section>
<h2><a name="Configuring_the_launch-time_class_path"></a>Configuring the launch-time class path</h2>
<p>The launch-time class path has an empty default, which means (because
PL/Java has a main module) that there is no class path. It does <i>not</i>
default to finding class files in the backend's current directory (which,
in a pre-Java-9 runtime, is what an empty class path would mean).</p>
<p>There may at times be a reason to place some jar or jars on the launch-time
class path, rather than installing them in SQL with <code>sqlj.install_jar</code> in
the usual way. It can be set by adding a <code>-Djava.class.path=...</code> in the
<code>pljava.vmoptions</code> configuration variable. Like the module path, its syntax
is simply the jar file pathnames, separated by the platform's path separator
character.</p></section>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
        Copyright &#169;      2003&#x2013;2024<a href="http://tada.se/eng/">Tada AB</a>.
.      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
