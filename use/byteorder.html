<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.11.1 from src/site/markdown/use/byteorder.md.vm at 2025-03-23

 | Rendered using Apache Maven Default Skin
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.11.1" />
    <title>PostgreSQL PL/Java &#x2013; Setting byte order in PL/Java 1.5.0 and later</title>
    <link rel="stylesheet" href="../css/maven-base.css" />
    <link rel="stylesheet" href="../css/maven-theme.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />
  </head>
  <body class="composite">
    <div id="banner">
<a href="https://tada.github.io/pljava/" id="bannerLeft" title="PL/Java logo combining the PostgreSQL elephant and a Java bean"><img src="../images/pljava_logo.jpg"  alt="PL/Java logo combining the PostgreSQL elephant and a Java bean"/></a>      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
      <div class="xleft">
        <span id="publishDate">Last Published: 2025-03-23</span>
           | <span id="projectVersion">Version: 1.6.9</span>
      </div>
      <div class="xright"><a href="https://github.com/tada/pljava/wiki/" class="externalLink" title="Wiki">Wiki</a> |
<a href="https://github.com/tada/pljava/issues" class="externalLink" title="Issues">Issues</a> |
<a href="https://www.postgresql.org/list/pljava-dev/" class="externalLink" title="Mailing list">Mailing list</a> |
<a href="https://github.com/tada/pljava/tree/master/" class="externalLink" title="Code">Code</a>      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
       <h5>Usage</h5>
    <ul>
     <li class="none"><a href="../build/build.html" title="Building PL/Java">Building PL/Java</a></li>
     <li class="none"><a href="../install/install.html" title="Installing into PostgreSQL">Installing into PostgreSQL</a></li>
     <li class="none"><a href="../install/upgrade.html" title="Upgrading">Upgrading</a></li>
     <li class="none"><a href="../build/package.html" title="Packaging PL/Java">Packaging PL/Java</a></li>
     <li class="none"><a href="../use/use.html" title="User guide">User guide</a></li>
     <li class="none"><a href="../develop/develop.html" title="Developer notes">Developer notes</a></li>
    </ul>
       <h5>Release Information</h5>
    <ul>
     <li class="none"><a href="../releasenotes.html" title="Release notes">Release notes</a></li>
    </ul>
       <h5>Modules</h5>
    <ul>
     <li class="none"><a href="../pljava-api/index.html" title="PL/Java API">PL/Java API</a></li>
     <li class="none"><a href="../pljava/index.html" title="PL/Java backend Java code">PL/Java backend Java code</a></li>
     <li class="none"><a href="../pljava-so/index.html" title="PL/Java backend native code">PL/Java backend native code</a></li>
     <li class="none"><a href="../pljava-ant/index.html" title="PL/Java Ant tasks">PL/Java Ant tasks</a></li>
     <li class="none"><a href="../pljava-examples/index.html" title="PL/Java examples">PL/Java examples</a></li>
     <li class="none"><a href="../pljava-packaging/index.html" title="PL/Java packaging">PL/Java packaging</a></li>
     <li class="none"><a href="../pljava-pgxs/index.html" title="PL/Java PGXS">PL/Java PGXS</a></li>
    </ul>
       <h5>Project Documentation</h5>
    <ul>
     <li class="collapsed"><a href="../project-info.html" title="Project Information">Project Information</a></li>
    </ul>
      <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="../images/logos/maven-feather.png" />
      </a>
      </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
<h1>Setting byte order in PL/Java 1.5.0 and later</h1>
<p>The byte order of the system where PostgreSQL is running is a detail mostly
invisible in PL/Java, but there are two capabilities of PL/Java where it can
matter:</p>
<dl>

<dt>Mirrored types</dt>
<dd>PL/Java allows associating a Java class with any <i>existing</i> PostgreSQL type
that does not have a predefined JDBC or PL/Java mapping. The existing type
can be either a composite type (a tuple of typed values) or a base type.
For a base type, the Java class must be written with knowledge of how
PostgreSQL lays out the stored form of the data. The <a class="externalLink" href="https://github.com/tada/pljava/tree/master//pljava-examples/src/main/java/org/postgresql/pljava/example/annotation/Point.java"><code>Point</code> example</a>
illustrates a mirrored type. <i>If PL/Java uses a different byte order than
the underlying system, mirrored types will be visibly broken, having
different values seen in PostgreSQL and in Java.</i></dd>
<dt>Base types</dt>
<dd>New PostgreSQL base types can be defined with PL/Java. The
<a class="externalLink" href="https://github.com/tada/pljava/tree/master//pljava-examples/src/main/java/org/postgresql/pljava/example/annotation/ComplexScalar.java"><code>ComplexScalar</code> example</a> illustrates a PL/Java-defined base type.
With a base type, differences between PL/Java byte order and that of the
underlying system are less noticeable (because nothing but PL/Java ever
touches the type's representation). However, in a database with existing
data stored as PL/Java base types, <i>changing</i> PL/Java's byte order will
render the data visibly bogus.</dd>
</dl>
<p><i>In older PL/Java versions up to and including <code>1.5.0-BETA2</code>, byte order was
always big-endian regardless of the underlying system.</i> That means that on
little-endian hardware (which is very common), PL/Java <i>mirrored types</i> will
have been noticeably broken, and probably seldom used. Base types may have seen
more use, and existing databases may have data stored in PL/Java base types
using big-endian order.</p>
<p><i>Beginning with PL/Java 1.5.0, byte order is selectable, and has different
defaults for base types and mirrored types.</i> For <i>base</i> types, the default
remains big-endian, to minimize disruption if a database has legacy data
stored that way, and to preserve the binary send/receive/<code>COPY</code> format for
those types. For <i>mirrored</i> types, the default is changed to native
(that is, the same as the underlying system),
because nothing else makes much sense for a mirrored type.</p>
<p>At present, all PL/Java base types implicitly have a send/receive/<code>COPY</code>
binary format reflecting their internal stored format, and are not able to
use their <code>send</code> and <code>receive</code> function slots to define a custom format for
binary transfer. Because the <a class="externalLink" href="http://www.postgresql.org/docs/8.2/static/sql-copy.html#AEN46503">binary <code>COPY</code> format documentation</a>
specifies network byte order (that is, big-endian), there are no plans to change
the default stored form from <code>big_endian</code> for base types, until some future
release decouples the stored representation from that for binary transfer.</p>
<p>In some future release, the default byte order for base types may change,
and a site with stored data in PL/Java base types will then need to apply a
migration step to the existing data (or keep the big-endian byte order by
explicitly selecting it instead of the default). Methods to migrate existing
data are covered below.</p><section>
<h2><a name="How_to_configure_PL.2FJava_byte_order"></a>How to configure PL/Java byte order</h2>
<p>The byte order is set with Java system properties, which can be specified
with the <code>-D</code> option within the PostgreSQL configuration setting
<code>pljava.vmoptions</code>. For example, to set <code>native</code> byte order for all uses:</p>

<div class="source">
<pre><code>SET pljava.vmoptions TO '-Dorg.postgresql.pljava.udt.byteorder=native`;
</code></pre></div>
<p>The allowable values are <code>big_endian</code>, <code>little_endian</code>, and <code>native</code>.</p>
<p>More-specific properties are available to set the byte order for specific
uses, and more-specific ones override less-specific ones:</p>

<div class="source">
<pre><code>org.postgresql.pljava.udt.byteorder.scalar
org.postgresql.pljava.udt.byteorder.mirror
</code></pre></div>
<p>Again, for release 1.5.0, the defaults are <code>big_endian</code> for <code>scalar</code> and
<code>native</code> for <code>mirror</code>.</p>
<p>Even these more-specific properties are still shortcuts, and only work at the
time of starting the Java VM. After the VM is running, these properties do not
exist, setting them has no effect, and the only properties that matter are
four even more specific ones that set the <code>scalar</code> and <code>mirror</code> byte ordering
for both directions of conversion. What possible use that could have is the
subject of the next section.</p><section>
<h3><a name="Migration_of_existing_data"></a>Migration of existing data</h3>
<p>While there is no need for a migration step as long as the base type byte order
remains big-endian, and there will be no change to that default until a future
PL/Java release, workable migration approaches are covered here in advance.</p>
<p>A simple migration approach will be to do a (non-binary) dump (with PL/Java
still configured for big-endian order), change PL/Java's configuration to use
native order, and reload the data.</p>
<p>It is also possible, with a careful procedure and making use of the ability to
set byte order independently for conversion from PostgreSQL to Java objects
and the reverse direction, to do the migration with <code>UPDATE</code>. This method is
covered on the <a href="byteordermigrate.html">byte-order migration page</a>.</p></section></section>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
        Copyright &#169;      2003&#x2013;2025<a href="http://tada.se/eng/">Tada AB</a>.
.      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
