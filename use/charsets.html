<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia Site Renderer 1.6 at 2016-01-26 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>PostgreSQL PL/Java &#x2013; Database character set encodings</title>
    <style type="text/css" media="all">
      @import url("../css/maven-base.css");
      @import url("../css/maven-theme.css");
      @import url("../css/site.css");
    </style>
    <link rel="stylesheet" href="../css/print.css" type="text/css" media="print" />
    <meta name="Date-Revision-yyyymmdd" content="20160126" />
    <meta http-equiv="Content-Language" content="en" />
        
        </head>
  <body class="composite">
    <div id="banner">
                        <a href="https://tada.github.io/pljava/" id="bannerLeft" title="PL/Java logo combining the PostgreSQL elephant and a Java bean">
                                                <img src="../images/pljava_logo.jpg" alt="PL/Java logo combining the PostgreSQL elephant and a Java bean" />
                </a>
                    <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
            
                    
                <div class="xleft">
        <span id="publishDate">Last Published: 2016-01-26</span>
                  &nbsp;| <span id="projectVersion">Version: 1.5.0-SNAPSHOT</span>
                      </div>
            <div class="xright">                    <a href="https://github.com/tada/pljava/wiki/" class="externalLink" title="Wiki">Wiki</a>
            |
                        <a href="https://github.com/tada/pljava/issues" class="externalLink" title="Issues">Issues</a>
            |
                        <a href="http://lists.pgfoundry.org/pipermail/pljava-dev/" class="externalLink" title="Mailing list">Mailing list</a>
            |
                        <a href="https://github.com/tada/pljava/tree/master/" class="externalLink" title="Code">Code</a>
              
                    
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
             
                    
                                <h5>Usage</h5>
                  <ul>
                  <li class="none">
                          <a href="../build/build.html" title="Building PL/Java">Building PL/Java</a>
            </li>
                  <li class="none">
                          <a href="../install/install.html" title="Installing into PostgreSQL">Installing into PostgreSQL</a>
            </li>
                  <li class="none">
                          <a href="../use/use.html" title="User guide">User guide</a>
            </li>
          </ul>
                       <h5>Release Information</h5>
                  <ul>
                  <li class="none">
                          <a href="../releasenotes.html" title="Release notes">Release notes</a>
            </li>
          </ul>
                       <h5>Modules</h5>
                  <ul>
                  <li class="none">
                          <a href="../pljava-api/index.html" title="PL/Java API">PL/Java API</a>
            </li>
                  <li class="none">
                          <a href="../pljava/index.html" title="PL/Java backend Java code">PL/Java backend Java code</a>
            </li>
                  <li class="none">
                          <a href="../pljava-so/index.html" title="PL/Java backend native code">PL/Java backend native code</a>
            </li>
                  <li class="none">
                          <a href="../pljava-deploy/index.html" title="PL/Java Deploy">PL/Java Deploy</a>
            </li>
                  <li class="none">
                          <a href="../pljava-ant/index.html" title="PL/Java Ant tasks">PL/Java Ant tasks</a>
            </li>
                  <li class="none">
                          <a href="../pljava-examples/index.html" title="PL/Java examples">PL/Java examples</a>
            </li>
                  <li class="none">
                          <a href="../pljava-packaging/index.html" title="PL/Java packaging">PL/Java packaging</a>
            </li>
          </ul>
                       <h5>Project Documentation</h5>
                  <ul>
                                                                                                                                                                                                                                                                          <li class="collapsed">
                          <a href="../project-info.html" title="Project Information">Project Information</a>
                  </li>
          </ul>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="../images/logos/maven-feather.png" />
      </a>
                   
                    
            </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <h1>Database character set encodings</h1>
<p>Strings in Java, by definition, are of Unicode characters. PL/Java 1.5.0 is rigorous in the treatment of strings passed and returned between Java and PostgreSQL.</p>
<p>If the database server encoding is <tt>UTF8</tt>, all strings will roundtrip between PostgreSQL and Java without alteration. With any other server encoding that is a defined subset of Unicode, strings that include only characters that exist in the server encoding will be converted successfully.</p>
<p>Characters that cannot be represented in the selected encoding, as well as any byte sequences that are not valid encodings of characters, will produce exceptions. Reflecting its role as a database backend component, PL/Java will not silently introduce character substitutions or other alteration or loss of string data.</p>
<p>PL/Java does <i>not</i> automatically perform, or enforce, any <a class="externalLink" href="http://unicode.org/faq/normalization.html">normalization</a> when strings are passed or returned. Any requirements concerning normalization must be handled explicitly.</p>
<div class="section">
<h2><a name="The_special_encoding_SQL_ASCII"></a>The special encoding <tt>SQL_ASCII</tt></h2>
<p>The encoding <tt>SQL_ASCII</tt>, as described <a class="externalLink" href="http://www.postgresql.org/docs/current/static/multibyte.html">in the PostgreSQL documentation</a>,</p>

<blockquote>
<p>&#x2026; behaves considerably differently from the other settings. When the server character set is <tt>SQL_ASCII</tt>, the server interprets byte values 0-127 according to the ASCII standard, while byte values 128-255 are taken as uninterpreted characters. No encoding conversion will be done when the setting is <tt>SQL_ASCII</tt>. Thus, this setting is not so much a declaration that a specific encoding is in use, as a declaration of ignorance about the encoding. In most cases, if you are working with any non-ASCII data, it is unwise to use the <tt>SQL_ASCII</tt> setting because PostgreSQL will be unable to help you by converting or validating non-ASCII characters.</p>
</blockquote>
<div class="section">
<h3><a name="Using_PLJava_with_server_encoding_SQL_ASCII"></a>Using PL/Java with server encoding <tt>SQL_ASCII</tt></h3>
<p>When the server encoding is <tt>SQL_ASCII</tt>, the only safe way for PL/Java to treat it is as strict ASCII, throwing exceptions if asked to convert any string involving characters outside of ASCII.</p>
<p>If PL/Java must be used with <tt>SQL_ASCII</tt> as the server encoding, the cases are (by increasing complexity):</p>

<ol style="list-style-type: decimal">
  
<li>
<p>The database contains no non-ASCII data (or none that will be touched in Java code). There will be no difficulty.</p></li>
  
<li>
<p>The database contains non-ASCII data all known to be in one standard encoding. It would be simplest for the database to be recreated with this encoding selected, but that may be impractical for various reasons. In that case, this can be handled in the same way as the next case.</p></li>
  
<li>
<p>The database contains non-ASCII data in <i>more than one</i> encoding, with the application somehow knowing which encoding is used where. That is completely possible because <tt>SQL_ASCII</tt> does not guarantee or validate anything (which means it can also happen over time without being intended). The rigorous approach in this case is to write Java code expecting and returning <tt>bytea</tt> and some indication of the encoding to be used, and perform explicit conversions.</p></li>
</ol></div></div>
<div class="section">
<h2><a name="Using_PLJava_with_standard_not_SQL_ASCII_encodings_other_than_UTF8"></a>Using PL/Java with standard (not <tt>SQL_ASCII</tt>) encodings other than <tt>UTF8</tt></h2>
<p>PL/Java itself will transparently transcode strings from and to any supported encoding, only throwing exceptions if a string coming from PostgreSQL contains sequences not valid in the server encoding, or if a Java string going to PostgreSQL contains characters the server encoding cannot represent. As long as strings do not include unrepresentable characters, PL/Java considers any standard encoding as good as any other.</p>
<div class="section">
<h3><a name="PostgreSQLs_own_limitations_on_encodings_other_than_UTF8"></a>PostgreSQL&#x2019;s own limitations on encodings other than <tt>UTF8</tt></h3>
<p>Certain features of PostgreSQL itself, however, are degraded in any encoding except <tt>UTF8</tt>:</p>

<ul>
  
<li>
<p>The hexadecimal escapes in a <a class="externalLink" href="http://www.postgresql.org/docs/current/static/sql-syntax-lexical.html#SQL-SYNTAX-STRINGS"><tt>U&amp;'...'</tt> Unicode character string literal</a> are only allowed to encode ASCII characters.</p>
  
<blockquote>The Unicode escape syntax works only when the server encoding is UTF8. When other server encodings are used, only code points in the ASCII range (up to \007F) can be specified.
  </blockquote></li>
  
<li>The <a class="externalLink" href="http://www.postgresql.org/docs/current/static/functions-string.html"><tt>ascii</tt> and <tt>chr</tt> functions</a> behave two different ways, depending on whether the server encoding is <i>a single-byte encoding</i>, or <i>any multi-byte encoding other than <tt>UTF8</tt></i>.
  
<ul>
    
<li>If it is a multi-byte encoding other than <tt>UTF8</tt>, they are usable only for strictly ASCII characters (values through 127, or 7f hex), and no others even if available in the encoding.</li>
    
<li>If it is a single-byte encoding, then they are usable with values through 255, and therefore all non-NUL characters available in the encoding, but <i>the numeric value is that of the encoded byte rather than the Unicode codepoint</i>.</li>
  </ul></li>
</ul>
<p>The odd behavior of <tt>ascii</tt> and <tt>chr</tt> is easily worked around, as simple to/from-codepoint functions are trivial to write in Java or most other PLs.</p>
<p>The restriction on <tt>U&amp;'...'</tt> strings may be more inconvenient. It does not, of course, <i>prevent</i> writing string literals with non-ASCII content; they can always be written in direct, plain-quoted-literal form, as long as the server and client encodings both cover the content and an editor or input method is in use that allows them to be entered, and a font in which they can be seen. The chief use of the <tt>U&amp;'...'</tt> form may be when, for explicitness or ease of editing, it is preferred to use a hexadecimal escape instead of entering a given character directly, but that&#x2019;s exactly what PostgreSQL&#x2019;s <tt>U&amp;'...'</tt> syntax can&#x2019;t be used for if the server encoding isn&#x2019;t <tt>UTF8</tt>.</p>
<p>Workarounds are possible, of course, such as defining an <tt>IMMUTABLE</tt> function in Java or another PL that accepts a string with a hexadecimal escape syntax and returns the decoded string, and using the function call (applied to a plain string literal with escapes) where otherwise a <tt>U&amp;'...'</tt> literal would be used.</p></div></div>
<div class="section">
<h2><a name="Bottom_line"></a>Bottom line</h2>
<p>Everything is simplest when using PL/Java in a database with <tt>UTF8</tt> as the server encoding.</p></div>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
              Copyright &#169;                    2003&#x2013;2016
                        <a href="http://tada.se/eng/">Tada AB</a>.
            All rights reserved.      
                    
                  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
