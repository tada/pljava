<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.9.2 from src/site/markdown/releasenotes.md.vm at 2023-09-19

 | Rendered using Apache Maven Default Skin
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.9.2" />
    <title>PostgreSQL PL/Java &#x2013; Release notes</title>
    <link rel="stylesheet" href="./css/maven-base.css" />
    <link rel="stylesheet" href="./css/maven-theme.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
  </head>
  <body class="composite">
    <div id="banner">
<a href="https://tada.github.io/pljava/" id="bannerLeft" title="PL/Java logo combining the PostgreSQL elephant and a Java bean"><img src="images/pljava_logo.jpg"  alt="PL/Java logo combining the PostgreSQL elephant and a Java bean"/></a>      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
      <div class="xleft">
        <span id="publishDate">Last Published: 2023-09-19</span>
          &#xA0;| <span id="projectVersion">Version: 1.6.6</span>
      </div>
      <div class="xright"><a href="https://github.com/tada/pljava/wiki/" class="externalLink" title="Wiki">Wiki</a> |
<a href="https://github.com/tada/pljava/issues" class="externalLink" title="Issues">Issues</a> |
<a href="https://www.postgresql.org/list/pljava-dev/" class="externalLink" title="Mailing list">Mailing list</a> |
<a href="https://github.com/tada/pljava/tree/master/" class="externalLink" title="Code">Code</a>      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
       <h5>Usage</h5>
    <ul>
     <li class="none"><a href="build/build.html" title="Building PL/Java">Building PL/Java</a></li>
     <li class="none"><a href="install/install.html" title="Installing into PostgreSQL">Installing into PostgreSQL</a></li>
     <li class="none"><a href="install/upgrade.html" title="Upgrading">Upgrading</a></li>
     <li class="none"><a href="build/package.html" title="Packaging PL/Java">Packaging PL/Java</a></li>
     <li class="none"><a href="use/use.html" title="User guide">User guide</a></li>
     <li class="none"><a href="develop/develop.html" title="Developer notes">Developer notes</a></li>
    </ul>
       <h5>Release Information</h5>
    <ul>
     <li class="none"><strong>Release notes</strong></li>
    </ul>
       <h5>Modules</h5>
    <ul>
     <li class="none"><a href="pljava-api/index.html" title="PL/Java API">PL/Java API</a></li>
     <li class="none"><a href="pljava/index.html" title="PL/Java backend Java code">PL/Java backend Java code</a></li>
     <li class="none"><a href="pljava-so/index.html" title="PL/Java backend native code">PL/Java backend native code</a></li>
     <li class="none"><a href="pljava-ant/index.html" title="PL/Java Ant tasks">PL/Java Ant tasks</a></li>
     <li class="none"><a href="pljava-examples/index.html" title="PL/Java examples">PL/Java examples</a></li>
     <li class="none"><a href="pljava-packaging/index.html" title="PL/Java packaging">PL/Java packaging</a></li>
     <li class="none"><a href="pljava-pgxs/index.html" title="PL/Java PGXS">PL/Java PGXS</a></li>
    </ul>
       <h5>Project Documentation</h5>
    <ul>
     <li class="collapsed"><a href="project-info.html" title="Project Information">Project Information</a></li>
    </ul>
      <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
      </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
<h1>Release notes</h1><section>
<h2><a name="PL.2FJava_1.6.6"></a>PL/Java 1.6.6</h2>
<p>This is the sixth minor update in the PL/Java 1.6 series. It adds support for PostgreSQL 16 and confirms compatibility with Java 21, and fixes some bugs, with few other notable changes. Further information on the changes may be found below.</p><section>
<h3><a name="Version_compatibility"></a>Version compatibility</h3>
<p>PL/Java 1.6.6 can be built against recent PostgreSQL versions including 16, and older ones back to 9.5, using Java SE 9 or later. The Java version used at runtime does not have to be the same version used for building. PL/Java itself can run on any Java version 9 or later. PL/Java functions can be written for, and use features of, whatever Java version will be loaded at run time. See <a href="build/versions.html">version compatibility</a> for more detail.</p>
<p>Some builds of Java 20 are affected by a bug, <a class="externalLink" href="https://bugs.openjdk.org/browse/JDK-8309515">JDK-8309515</a>. PL/Java will report an error if detects it is affected by that bug, and the solution can be to use a Java version earlier than 20, or one recent enough to have the bug fixed. The bug has been fixed in Java 21.</p>
<p>PL/Java 1.6.6 will definitely no longer build on PostgreSQL versions older than 9.5. It has made no attempt to support them since 1.6.0, and lingering conditional code for older versions has now been removed.</p></section><section>
<h3><a name="Changes"></a>Changes</h3><section>
<h4><a name="Changes_in_XML_support"></a>Changes in XML support</h4><section>
<h5><a name="Java_17.E2.80.99s_standardized_XML_feature_and_property_names_added"></a>Java 17&#x2019;s standardized XML feature and property names added</h5>
<p>Java 17 added standardized, easy-to-remember names for a number of features and properties the underlying XML implementations had formerly supported under implementation-specific names. PL/Java&#x2019;s <code>Adjusting.XML</code> API already needed to know those various other names, to attempt using them to configure the desired features and properties. Now it tries the new standard names too.</p></section><section>
<h5><a name="Better_control_when_a_feature_or_property_can.E2.80.99t_be_set_as_intended"></a>Better control when a feature or property can&#x2019;t be set as intended</h5>
<p>The original documentation for the feature and property setters in the <code>Adjusting.XML</code> API said &#x201c;the adjusting methods are best-effort and do not provide an indication of whether the requested adjustment was made&#x201d;. (At the same time, failures could produce voluminous output to the log.)</p>
<p>The new <a href="pljava-api/apidocs/org.postgresql.pljava/org/postgresql/pljava/Adjusting.XML.Parsing.html#method.summary"><code>lax(boolean)</code></a> method offers more control. If not used, adjustment failures are logged (as before, but more compactly in the case of multiple failures in one sequence of adjustments). Or, <code>lax(true)</code> can be used to silently discard any failures up to that point in a sequence of adjustments, or <code>lax(false)</code> to have the exceptions chained together and thrown.</p>
<p>The addition of the new Java 17 standardized names can complicate version-agnostic configuration of other elements in the Java XML APIs, such as <code>Transformer</code>, that are not directly covered by PL/Java&#x2019;s <code>Adjusting.XML.Parsing</code> methods. Client code may find the new <code>Adjusting.XML</code> method <a href="pljava-api/apidocs/org.postgresql.pljava/org/postgresql/pljava/Adjusting.XML.html#method.detail"><code>setFirstSupported</code></a> convenient for that purpose; <a class="externalLink" href="https://github.com/tada/pljava/blob/V1_6_6/pljava-examples/src/main/java/org/postgresql/pljava/example/annotation/PassXML.java#L528">an example</a> illustrates.</p></section></section><section>
<h4><a name="Packaging_.2F_testing"></a>Packaging / testing</h4><section>
<h5><a name="Support_choice_of_PGJDBC_or_pgjdbc-ng_in_Node"></a>Support choice of <code>PGJDBC</code> or <code>pgjdbc-ng</code> in <code>Node</code></h5>
<p>The package jar produced as the last step of the build includes a <a href="develop/node.html">test harness</a> similar to the <code>PostgresNode</code> Perl module. It formerly worked only with the <code>pgjdbc-ng</code> driver. Now it works with either <code>PGJDBC</code> or <code>pgjdbc-ng</code>, and provides features for writing test scripts that do not depend on the driver chosen.</p></section></section><section>
<h4><a name="Source_code"></a>Source code</h4>
<ul>

<li>Minor changes to support PostgreSQL 16</li>
<li>Conditional code supporting PostgreSQL versions older than 9.5 removed</li>
<li>Old non-HTML5 elements (rejected by Javadoc 17 and later) removed from doc comments</li>
<li>The <code>pureNonVirtualCalled</code> method removed to quiet warnings from recent C compilers</li>
<li>Schema qualification in embedded SQL added to two operators that had been overlooked in the earlier round of adding such qualification</li>
</ul></section></section><section>
<h3><a name="Bugs_fixed"></a>Bugs fixed</h3>
<ul>

<li><a class="externalLink" href="https://github.com/tada/pljava/issues/455"><code>NEWLINE</code> pattern can fail to match</a></li>
</ul></section><section>
<h3><a name="PL.2FJava_1.6.5"></a>PL/Java 1.6.5</h3>
<p>This is the fifth minor update in the PL/Java 1.6 series. It adds support for PostgreSQL 15 and fixes some bugs, with few other notable changes. Further information on the changes may be found below.</p><section>
<h4><a name="Version_compatibility"></a>Version compatibility</h4>
<p>PL/Java 1.6.5 can be built against recent PostgreSQL versions including 15, and older ones back to 9.5, using Java SE 9 or later. The Java version used at runtime does not have to be the same version used for building. PL/Java itself can run on any Java version 9 or later. PL/Java functions can be written for, and use features of, whatever Java version will be loaded at run time. See <a href="build/versions.html">version compatibility</a> for more detail.</p>
<p>Some builds of Java 20 are affected by a bug, <a class="externalLink" href="https://bugs.openjdk.org/browse/JDK-8309515">JDK-8309515</a>. PL/Java will report an error if detects it is affected by that bug, and the solution can be to use a Java version earlier than 20, or one recent enough to have the bug fixed.</p></section><section>
<h4><a name="Changes"></a>Changes</h4><section>
<h5><a name="Changes_affecting_administration"></a>Changes affecting administration</h5><section>
<h6><a name="Bugs_affecting_install_jar_from_http.2Fhttps_URLs_fixed"></a>Bugs affecting <code>install_jar</code> from http/https URLs fixed</h6>
<p>CI testing now makes sure that http URLs work and the appropriate <code>java.net.URLPermission</code> can be granted in <code>pljava.policy</code> where the comments indicate.</p></section></section><section>
<h5><a name="Improvements_to_the_annotation-driven_SQL_generator"></a>Improvements to the annotation-driven SQL generator</h5><section>
<h6><a name="PL.2FJava_functions_can_be_declared_on_interfaces_as_well_as_classes"></a>PL/Java functions can be declared on interfaces as well as classes</h6>
<p>The SQL/JRT specification has always only said &#x2018;class&#x2019;, but it could be debated whether &#x2018;class&#x2019; was intended strictly or inclusively. As there is no technical obstacle to using static methods declared on an interface, and PL/Java&#x2019;s runtime already could do so, the SQL generator no longer disallows <code>@Function</code> annotations on them.</p></section><section>
<h6><a name="SQL_generator_reports_compatibility_with_a_more_recent_Java_source_version"></a>SQL generator reports compatibility with a more recent Java source version</h6>
<p>Because PL/Java 1.6 retains compatibility for building on Java versions back to 9, the SQL generator previously reported 9 as the source version supported. This produced warnings building user code to target a later version of Java, which were only an issue for sites using a fail-on-warning policy.</p>
<p>The SQL generator now reports its supported source version as the earlier of: the Java version being used, or the latest Java version on which it has been successfully tested. In this release, that is Java 20.</p></section></section><section>
<h5><a name="Improvements_to_documentation"></a>Improvements to documentation</h5><section>
<h6><a name="Use_of_--add-modules_to_access_Java_modules_not_read_by_default.2C_explained"></a>Use of <code>--add-modules</code> to access Java modules not read by default, explained</h6>
<p>By default, PL/Java starts up with a fairly small set of Java modules readable. The documentation did not explain the use of <code>--add-modules</code> in <code>pljava.vmoptions</code> to expand that set when user code will refer to other modules. That is <a href="install/vmoptions.html#Adding_to_the_set_of_readable_modules">now documented</a>.</p></section></section></section><section>
<h4><a name="Enhancement_requests_addressed"></a>Enhancement requests addressed</h4>
<ul>

<li><a class="externalLink" href="https://github.com/tada/pljava/issues/426">Allow functions from an interface</a></li>
</ul></section><section>
<h4><a name="Bugs_fixed"></a>Bugs fixed</h4>
<ul>

<li><a class="externalLink" href="https://github.com/tada/pljava/issues/416">Crash on startup with <code>SQL_ASCII</code> database and bad <code>vmoptions</code></a></li>
<li><a class="externalLink" href="https://github.com/tada/pljava/issues/434">Installed by <code>LOAD</code> then packaged as extension broken in recent PostgreSQL updates</a></li>
<li><a class="externalLink" href="https://github.com/tada/pljava/issues/435">Java 20 breaks <code>LexicalsTest.testSeparator</code></a></li>
<li><a class="externalLink" href="https://github.com/tada/pljava/issues/419">Not found JDK 11 <code>java.net.http.HttpClient</code></a> (documentation added)</li>
<li><a class="externalLink" href="https://github.com/tada/pljava/issues/425"><code>SocketPermission</code> on <code>install_jar</code></a></li>
<li><a class="externalLink" href="https://github.com/tada/pljava/issues/407">The timer in <code>_destroyJavaVM</code> does not take effect</a></li>
<li>PostgreSQL 15 support <a class="externalLink" href="https://github.com/tada/pljava/issues/410">410</a>, <a class="externalLink" href="https://github.com/tada/pljava/issues/412">412</a></li>
<li><a class="externalLink" href="https://github.com/tada/pljava/issues/403">Cannot specify java release other than &#x2018;9&#x2019; for <code>maven-compiler-plugin</code></a></li>
<li><a class="externalLink" href="https://github.com/tada/pljava/issues/402">Fail validation if function declares <code>TRANSFORM FOR TYPE</code></a></li>
<li><a class="externalLink" href="https://github.com/tada/pljava/issues/438">&#x201c;cannot parse AS string&#x201d; for 1-letter identifiers</a></li>
</ul></section><section>
<h4><a name="Credits"></a>Credits</h4>
<p>Thanks in release 1.6.5 to Francisco Miguel Biete Banon, Christoph Berg, Frank Blanning, Stephen Frost, Casey Lai, Krzysztof Nienartowicz, Yuril Rashkovskii, Tim Van Holder, <code>aadrian</code>, <code>sincatter</code>, <code>tayalrun1</code>.</p></section></section><section>
<h3><a name="Earlier_releases"></a>Earlier releases</h3></section><section>
<h3><a name="PL.2FJava_1.6.4"></a>PL/Java 1.6.4</h3>
<p>This is the fourth minor update in the PL/Java 1.6 series. It is a minor bug-fix release with few other notable changes. Further information on the changes may be found below.</p><section>
<h4><a name="Changes"></a>Changes</h4><section>
<h5><a name="Changes_affecting_administration"></a>Changes affecting administration</h5><section>
<h6><a name="JEP_411_advisory_message_downgraded"></a>JEP 411 advisory message downgraded</h6>
<p>PL/Java follows certain administrative actions with an advisory message about upcoming Java changes that will affect policy enforcement. In 1.6.3, that message was always at <code>WARNING</code> level. In 1.6.4, it is downgraded to <code>NOTICE</code> level when running on Java versions before 17.</p>
<p>As before, updates on how PL/Java will adapt to the future Java changes can be watched by bookmarking <a class="externalLink" href="https://github.com/tada/pljava/wiki/JEP-411">the JEP 411 topic</a> on the PL/Java wiki.</p></section></section><section>
<h5><a name="Changes_to_runtime_behavior"></a>Changes to runtime behavior</h5><section>
<h6><a name="Java.E2.80.99s_thread_context_class_loader"></a>Java&#x2019;s thread context class loader</h6>
<p>Starting in 1.6.3, PL/Java has made sure the thread context class loader on entry to a function reflects the initiating loader for the implementing class, but in 1.6.3, the loader could be set too many times when executing a set-returning function. That could lead to the wrong loader being restored on function exit, likely only noticeable in an application with jars in multiple schemas and with nested Java function invocations.</p>
<p>That is fixed in this release.</p></section></section><section>
<h5><a name="Improvements_to_the_annotation-driven_SQL_generator"></a>Improvements to the annotation-driven SQL generator</h5><section>
<h6><a name="Correct_SQL_now_emitted_for_a_function_with_one_OUT_parameter"></a>Correct SQL now emitted for a function with <i>one</i> <code>OUT</code> parameter</h6>
<p>PostgreSQL requires a different form of declaration for a function with one <code>OUT</code> parameter than for a function with two or more. PL/Java was emitting the wrong form for the one-out-parameter case.</p>
<p>The documentation has been clarified and new <a href="pljava-examples/apidocs/org/postgresql/pljava/example/annotation/ReturnComposite.html#method.summary">examples</a> added to illustrate how Java methods should be structured and annotated for both cases.</p>
<p>The intended treatment can be ambiguous for some Java methods, without explicit annotations. For example, a Java method that returns <code>boolean</code> and has a trailing <code>ResultSet</code> parameter could be a single-row composite-returning function, or an ordinary function with a row-typed input parameter and <code>boolean</code> return. PL/Java has always silently chosen which interpretation to apply in such cases, and still does, but it now emits a comment into the generated deployment descriptor, explaining what annotation to use if a different meaning was intended.</p></section><section>
<h6><a name="BaseUDT_annotation_now_has_constants_for_known_type_categories"></a><code>BaseUDT</code> annotation now has constants for known type categories</h6>
<p>PostgreSQL user-defined types can be declared in categories, some of which are predefined. PL/Java&#x2019;s <code>BaseUDT</code> annotation now includes constants for those, which can be used in place of the single-letter codes for readability.</p></section></section></section><section>
<h4><a name="Bugs_fixed"></a>Bugs fixed</h4>
<ul>

<li><a class="externalLink" href="https://github.com/tada/pljava/issues/386">Wrong SQL generated for function with one <code>OUT</code> parameter</a></li>
<li><a class="externalLink" href="https://github.com/tada/pljava/issues/388"><code>Session</code> object not reliably singleton</a></li>
<li><a class="externalLink" href="https://github.com/tada/pljava/issues/389">Set-returning function has context classloader set too many times</a></li>
<li><a class="externalLink" href="https://github.com/tada/pljava/issues/390"><code>java.time.LocalDate</code> mismapping within 30 years of +/-infinity</a></li>
</ul></section></section><section>
<h3><a name="PL.2FJava_1.6.3_.2810_October_2021.29"></a>PL/Java 1.6.3 (10 October 2021)</h3>
<p>This is the third minor update in the PL/Java 1.6 series. It adds support for PostgreSQL 14, continues to improve the runtime behavior and the annotation-driven SQL generator, and fixes several bugs. Further information on the changes may be found below.</p><section>
<h4><a name="PL.2FJava_with_Java_17_and_later:_JEP_411"></a>PL/Java with Java 17 and later: JEP 411</h4>
<p>Current versions of PL/Java rely on Java security features that will be affected by JEP 411, beginning with Java 17. Java 17 itself will continue to provide the needed capabilities, with only deprecation marks and warnings added. Java 17 is also positioned as a long-term support release, so the option of continuing to run this PL/Java release will be available, with no loss of function, by continuing to run with Java versions up to and including 17.</p>
<p>For more on how PL/Java will adapt, please bookmark <a class="externalLink" href="https://github.com/tada/pljava/wiki/JEP-411">the JEP 411 topic</a> on the PL/Java wiki.</p>
<p>For this release, PL/Java will suppress a JEP 411-related warning from the Java runtime itself that would otherwise be emitted for every PostgreSQL backend that starts Java, and instead will issue a more informative &#x201c;migration advisory&#x201d; warning only on certain administrative actions no more than once per session, with a goal of ensuring that responsible administrators are aware of the expected future developments. The advisory message includes the URL to the wiki topic above.</p>
<p>This release also adds code to detect if it is on a future, post-Java 17 runtime where the needed functionality is not available, and throw informative exceptions with suggested corrective actions.</p></section><section>
<h4><a name="Changes"></a>Changes</h4><section>
<h5><a name="Changes_affecting_administration"></a>Changes affecting administration</h5><section>
<h6><a name="New_function_now_created_on_update"></a>New function now created on update</h6>
<p>The new <a href="pljava/apidocs/org.postgresql.pljava.internal/org/postgresql/pljava/management/Commands.html#alias_java_language"><code>SQLJ.ALIAS_JAVA_LANGUAGE</code></a> function introduced with 1.6 will now be present after an <code>ALTER EXTENSION UPDATE</code> if it was not before.</p></section><section>
<h6><a name="Message_if_the_Java_runtime_ends_the_backend_process_during_startup"></a>Message if the Java runtime ends the backend process during startup</h6>
<p>The Java runtime can behave antisocially for some startup issues, such as a misspelled jar in <code>pljava.module_path</code>, and silently terminate the backend process rather than reporting an error. (It writes a message, not to standard error, but to standard output, which from a PostgreSQL backend is not captured for logging, and may never be seen.) A message is now generated in that case, to provide at least some clue what has gone wrong.</p></section></section><section>
<h5><a name="Changes_to_runtime_behavior"></a>Changes to runtime behavior</h5><section>
<h6><a name="Java.E2.80.99s_thread_context_class_loader"></a>Java&#x2019;s thread context class loader</h6>
<p>PL/Java now supplies a known value for the current Java thread&#x2019;s context class loader on entry to a PL/Java function. It is the class loader for the PostgreSQL schema where the function is declared. The context class loader is referred to by numerous Java libraries and by Java&#x2019;s <code>ServiceLoader</code> class, which may expect to find services and resources along the PL/Java class path that has been configured for the function. Neglecting to set the context class loader opened the door to unexpected loading failures like <a class="externalLink" href="https://github.com/tada/pljava/issues/361">issue #361</a> that can require awkward or slow contortions to work around in user Java code.</p>
<p>This change is <a href="develop/contextloader.html">documented in more detail</a>. An opt-out setting is available.</p></section></section><section>
<h5><a name="Improvements_to_the_annotation-driven_SQL_generator"></a>Improvements to the annotation-driven SQL generator</h5><section>
<h6><a name="Now_able_to_declare_function_parameters_that_default_to_null"></a>Now able to declare function parameters that default to null</h6>
<p>It has been possible to annotate a function parameter with <a href="pljava-api/apidocs/org.postgresql.pljava/org/postgresql/pljava/annotation/SQLType.html"><code>@SQLType(defaultValue=...)</code></a> to give it any non-null default value, but because Java disallows null annotation values, that notation wasn&#x2019;t usable to declare a parameter that defaults to null. The new notation <a href="pljava-api/apidocs/org.postgresql.pljava/org/postgresql/pljava/annotation/SQLType.html"><code>@SQLType(optional=true)</code></a> means exactly that.</p></section><section>
<h6><a name="Fixes_a_bug_in_synthesis_of_COMMUTATOR.2FNEGATOR_operators"></a>Fixes a bug in synthesis of <code>COMMUTATOR</code>/<code>NEGATOR</code> operators</h6>
<p>It is now possible to code one method in Java and declare a full complement of operators based on it by combining commutation and negation. A <a class="externalLink" href="https://github.com/tada/pljava/commit/6bd5aa0">new example</a> is provided.</p></section></section></section><section>
<h4><a name="Bugs_fixed"></a>Bugs fixed</h4>
<ul>

<li><a class="externalLink" href="https://github.com/tada/pljava/issues/341"><code>ALTER EXTENSION UPDATE</code> does not create <code>sqlj.alias_java_language</code></a></li>
<li><a class="externalLink" href="https://github.com/tada/pljava/issues/343">&#x2026; fails on 4 cross-type operators by commute/negate from 1 function</a></li>
<li><a class="externalLink" href="https://github.com/tada/pljava/issues/347">Build failure dependent on <code>pg_config</code> output</a></li>
<li><a class="externalLink" href="https://github.com/tada/pljava/issues/342">Protection domain when validator runs initializer</a></li>
<li><a class="externalLink" href="https://github.com/tada/pljava/issues/350">Improve experience when <code>pljava.module_path</code> is incorrect</a></li>
<li><a class="externalLink" href="https://github.com/tada/pljava/issues/352">&#x201c;Failed to recognize schema&#x201d; possible during <code>pg_upgrade</code></a></li>
<li>Fixes and test coverage in <code>Lexicals.Identifier</code> serialization</li>
<li><a class="externalLink" href="https://github.com/tada/pljava/issues/355">Segmentation fault during <code>autovacuum</code></a></li>
<li><a class="externalLink" href="https://github.com/tada/pljava/issues/340"><code>java.nio.charset.MalformedInputException: Input length = 1</code></a></li>
<li><a class="externalLink" href="https://github.com/tada/pljava/issues/361">Thread context class loader</a></li>
<li><a class="externalLink" href="https://github.com/tada/pljava/issues/370"><code>MappedUDT</code> and types with <code>typlen=-2</code></a></li>
</ul></section><section>
<h4><a name="Updated_PostgreSQL_APIs_tracked"></a>Updated PostgreSQL APIs tracked</h4>
<ul>

<li>Regularized spelling of <code>pg_type</code> OID symbols</li>
<li>Changed TOAST pointer format supporting selectable TOAST compression methods</li>
<li>Demise of <code>ErrorData.show_funcname</code> (it was a vestige of frontend/backend protocol v2, long obsolete)</li>
</ul></section><section>
<h4><a name="Credits"></a>Credits</h4>
<p>Thanks to Krzysztof Nienartowicz, <code>ricdhen</code>, and <code>JanaParthasarathy</code>, who among them reported five of the issues fixed in this release.</p></section></section><section>
<h3><a name="PL.2FJava_1.6.2"></a>PL/Java 1.6.2</h3>
<p>This is the second minor update in the PL/Java 1.6 series, with two bugs fixed (including one that was likely to be a blocker for many applications). It adds a &#x2018;trial&#x2019; security policy, useful when migrating code from PL/Java 1.5 to identify permission grants that may be needed, and some minor but useful example functionality.</p><section>
<h4><a name="Changes"></a>Changes</h4><section>
<h5><a name="Bug_blocking_use_from_an_unprivileged_PostgreSQL_role_fixed"></a>Bug blocking use from an unprivileged PostgreSQL role fixed</h5>
<p>In 1.6.0 and 1.6.1, PL/Java could fail to start in a backend process if the effective PostgreSQL role was not a superuser or a member of <code>pg_read_all_settings</code>. That is fixed in this release.</p></section><section>
<h5><a name="Trial_security_policy_for_migrating_code_from_PL.2FJava_pre-1.6.0"></a>Trial security policy for migrating code from PL/Java pre-1.6.0</h5>
<p>When migrating code from pre-1.6.0 PL/Java versions, it may be necessary to add permission grants to the PL/Java 1.6 security policy, which is distributed as a minimal starting point.</p>
<p><a href="use/policy.html">Configuring permissions in PL/Java</a> covers the topic in general, and <a href="use/trial.html">Migrating to policy-based permissions</a> covers the new &#x2018;trial&#x2019; policy introduced in 1.6.2 to simplify the process.</p></section><section>
<h5><a name="Example_functions_using_XSLT_1.0_polished_for_simpler_use"></a>Example functions using XSLT 1.0 polished for simpler use</h5>
<p>Although 1.0 is obsolete and very limited compared to current versions of XSLT, the implementation in Java has two attractive properties. First, it is provided in the Java runtime with no need of a separate download such as Saxon, and second, it allows use of any accessible Java methods or constructors from XPath expressions, which can often make it more useful than the limitations of strict XSLT 1.0 would suggest.</p>
<p>The <a href="pljava-examples/apidocs/org/postgresql/pljava/example/annotation/PassXML.html#method.summary">example functions</a> <code>prepareXMLTransform</code>, <code>prepareXMLTransformWithJava</code>, and <code>transformXML</code>, which demonstrate how such functions can be coded, have also been given streamlined parameter lists with defaults to make them simple to use for real work.</p>
<p>One small but useful result is an easy way to indent XML for readability, simply by passing a null transform name and <code>indent =&gt; true</code> to <code>transformXML</code>.</p></section></section><section>
<h4><a name="Bugs_fixed"></a>Bugs fixed</h4>
<ul>

<li><a class="externalLink" href="https://github.com/tada/pljava/issues/331">must be superuser or a member of <code>pg_read_all_settings</code></a></li>
<li><a class="externalLink" href="https://github.com/tada/pljava/issues/330">Operator annotation can reject explicit operand types in error</a></li>
</ul></section><section>
<h4><a name="Credits"></a>Credits</h4>
<p>Thanks to Francisco Biete for the report of <a class="externalLink" href="https://github.com/tada/pljava/issues/331">#331</a>.</p></section></section><section>
<h3><a name="PL.2FJava_1.6.1_.2816_November_2020.29"></a>PL/Java 1.6.1 (16 November 2020)</h3>
<p><i>Note: 1.6.1 was released with <a class="externalLink" href="https://github.com/tada/pljava/issues/331">a bug</a> likely to be a blocker for many applications. It was fixed in 1.6.2.</i></p>
<p>This is the first minor update in the PL/Java 1.6 series, with two bugs fixed. It also adds functionality in the SQL generator, allowing automated declaration of new PostgreSQL aggregates, casts, and operators, and functions with <code>OUT</code> parameters.</p><section>
<h4><a name="Changes"></a>Changes</h4><section>
<h5><a name="Limitations_when_built_with_Java_10_or_11_removed"></a>Limitations when built with Java 10 or 11 removed</h5>
<p>PL/Java can now be built with any Java 9 or later (latest tested is 15 at time of writing), and the built artifact can use any Java 9 or later at run time (as selected by the <code>pljava.libjvm_location</code> configuration variable).</p>
<p>That was previously true when built with Java 9 or with Java 12 or later, but not when built with 10 (would not run on 9) or with 11 (would not run on 9 or 10). Those limits have been removed.</p></section><section>
<h5><a name="Functions_with_OUT_parameters"></a>Functions with <code>OUT</code> parameters</h5>
<p>PL/Java has long been able to declare a function that returns a composite type (or a set of such), by returning a named composite PostgreSQL type, or by being declared to return <code>RECORD</code>.</p>
<p>The former approach requires separately declaring a new composite type to PostgreSQL so it can be named as the function return. The <code>RECORD</code> approach does not require pre-declaring a type, but requires every caller of the function to supply a column definition list at the call site.</p>
<p>Declaring the function <a href="pljava-api/apidocs/org.postgresql.pljava/org/postgresql/pljava/annotation/Function.html#annotation.type.element.detail">with <code>OUT</code> parameters</a> offers a middle ground, where the function has a fixed composite return type with known member names and types, callers do not need to supply a column definition list, and no separate declaration of the type is needed.</p>
<p>There is no change to how such a function is coded at the Java source level; the new annotation element only changes the SQL generated to declare the function to PostgreSQL. <a href="pljava-examples/apidocs/org/postgresql/pljava/example/annotation/ReturnComposite.html#method.detail">Examples</a> are provided.</p></section><section>
<h5><a name="Generation_of_aggregate.2C_cast.2C_and_operator_declarations"></a>Generation of aggregate, cast, and operator declarations</h5>
<p>The SQL generator now recognizes <a href="pljava-api/apidocs/org.postgresql.pljava/org/postgresql/pljava/annotation/Aggregate.html"><code>@Aggregate</code></a>, <a href="pljava-api/apidocs/org.postgresql.pljava/org/postgresql/pljava/annotation/Cast.html"><code>@Cast</code></a>, and <a href="pljava-api/apidocs/org.postgresql.pljava/org/postgresql/pljava/annotation/Operator.html"><code>@Operator</code></a> annotations, generating the corresponding SQL deploy/undeploy scripts. Some examples (for <a href="pljava-examples/apidocs/org/postgresql/pljava/example/annotation/Aggregates.html">aggregates</a>, <a href="pljava-examples/apidocs/org/postgresql/pljava/example/annotation/IntWithMod.html">casts</a>, and <a href="pljava-examples/apidocs/org/postgresql/pljava/example/annotation/ComplexScalar.html">operators</a>) are provided. The reduction in boilerplate needed for a realistically-complete example can be seen in <a class="externalLink" href="https://github.com/beargiles/pljava-udt-type-extension/compare/98f1a6e...jcflack:3e56056">this comparison</a> of Bear Giles&#x2019;s <code>pljava-udt-type-extension</code> example; the two branches compared here are (1) using only the annotations supported in PL/Java 1.6.0 and (2) using also the new support in 1.6.1.</p></section></section><section>
<h4><a name="Bugs_fixed"></a>Bugs fixed</h4>
<ul>

<li><a class="externalLink" href="https://github.com/tada/pljava/issues/322">1.6.0: opening a ResourceBundle (or a resource) fails</a></li>
<li><a class="externalLink" href="https://github.com/tada/pljava/issues/328">Better workaround needed for javac 10 and 11 &#x2013;release bug</a></li>
</ul></section><section>
<h4><a name="Credits"></a>Credits</h4>
<p>Thanks to Bear Giles for the <code>pljava-udt-type-extension</code> example, which not only illustrates the SQL generation improvements in this release, but also exposed both of the bugs fixed here.</p></section></section><section>
<h3><a name="PL.2FJava_1.6.0_.2818_October_2020.29"></a>PL/Java 1.6.0 (18 October 2020)</h3>
<p><i>Note: 1.6.0 was released with <a class="externalLink" href="https://github.com/tada/pljava/issues/331">a bug</a> likely to be a blocker for many applications. It was fixed in 1.6.2.</i></p>
<p>This is the first release of a significantly refactored PL/Java 1.6 branch with a number of new features and changes. It requires Java 9 or later at build and run time, but retains the ability to run PL/Java application code built for earlier versions. It should be used with PostgreSQL 9.5 or later. For applications <i>requiring</i> an older Java or PostgreSQL version, the latest release in the PL/Java 1.5 line remains an option.</p>
<p><b>Note to package maintainers</b>: these release notes should be reviewed before an installation moves to 1.6.0 from a 1.5 or earlier version, so it is best packaged in a way that requires an affirmative choice to upgrade.</p><section>
<h4><a name="Version_compatibility"></a>Version compatibility</h4>
<p>PL/Java 1.6.0 can be built against recent PostgreSQL versions including 13, and older ones back to 9.5, using Java SE 9 or later. The Java version used at runtime does not have to be the same version used for building. PL/Java itself can run on any Java version 9 or later if built with Java 9 or with 12 or later (bugs in the Java 10 and 11 compilers prevent running on 9 if built with 10, or on 9 or 10 if built with 11). PL/Java functions can be written for, and use features of, whatever Java version will be loaded at run time. See <a href="build/versions.html">version compatibility</a> for more detail.</p>
<p>When used with GraalVM as the runtime VM, PL/Java functions can use Graal&#x2019;s &#x201c;polyglot&#x201d; capabilities to execute code in any other language available on GraalVM. In this release, it is not yet possible to directly declare a function in a language other than Java.</p>
<p>If building with GraalVM, please add <code>-Dpolyglot.js.nashorn-compat=true</code> on the <code>mvn</code> command line.</p></section><section>
<h4><a name="Changes"></a>Changes</h4><section>
<h5><a name="New_configurable_permissions_may_require_configuration"></a>New configurable permissions may require configuration</h5>
<p>Prior to 1.6.0, PL/Java hard-coded the permissions that were available to functions declared in the &#x2018;trusted&#x2019; language <code>java</code> or the &#x2018;untrusted&#x2019; language <code>javaU</code>. With 1.6.0, the exact permissions available for both cases can be configured in the <code>pljava.policy</code> file (found in the directory reported by <code>pg_config --sysconfdir</code>) as described in the <a href="use/policy.html">new policy documentation</a>.</p>
<p>Java&#x2019;s policy language can conditionally grant permissions but not deny them if another clause grants them. Therefore, the default policy must be somewhat restrictive, so a desired policy can be built from it with grant clauses.</p>
<p>In the 1.6.0 default policy, &#x2018;trusted&#x2019; (<code>java</code>) code has minimal permissions, suitable for general computation and interacting with the database, and &#x2018;untrusted&#x2019; (<code>javaU</code>) code has only the additional permission to access the file system. Existing user functions that worked in PL/Java 1.5.x and performed other actions, such as making network connections, will need the appropriate permissions (such as <code>java.net.URLPermission</code> or <code>java.net.SocketPermission</code>) granted via the policy file.</p>
<p>The policy can grant permissions more selectively than just to <code>java</code> or <code>javaU</code>. The <a href="use/policy.html">new documentation</a> covers the details, and also how to log, for troubleshooting purposes, the permissions being requested.</p>
<p>Whatever the reason, all down the years, a favorite &#x201c;is PL/Java working?&#x201d; check found online has been to read a Java system property with <code>System.getProperty</code>. Not all of those examples pick properties that can be read under the default policy. So, even some familiar habits like that may need revision, at least to use a property like <code>java.version</code> that is readable by default.</p>
<p>The former hard-coded permissions were by turns too lax or too strict, depending on what was needed, and interfered in some cases with the operation of the Java runtime itself, breaking (at least) its XSLT implementation and the profiling functions of <code>visualvm</code>. This release fixes those issues.</p></section><section>
<h5><a name="Validation_at_CREATE_FUNCTION_time_may_force_changes_to_deployment_procedures"></a>Validation at <code>CREATE FUNCTION</code> time may force changes to deployment procedures</h5>
<p>PL/Java can now detect problems with a function declaration, including missing dependencies, at the time of <code>CREATE FUNCTION</code>, rather than allowing the function to be created and reporting failure later when it is called.</p>
<p>This change may have an impact on some established procedures. For example, when installing a jar that contains deployment commands, deployment may fail if another required jar has not been installed and added to the class path first; in the past, the order did not matter. For details, see <a href="examples/examples.html#Exception_resolving_class_or_method_.28message_when_installing_examples.29">this section</a> in the documentation for the supplied examples, and the description of <code>check_function_bodies</code> in the <a href="use/variables.html">configuration variable reference</a>.</p></section><section>
<h5><a name="Java_9_module_system.3B_pljava.classpath_-.3E_pljava.module_path"></a>Java 9 module system; <code>pljava.classpath</code> -&gt; <code>pljava.module_path</code></h5>
<p>Because PL/Java itself is now modular code conforming to the module system introduced with Java 9, one configuration variable has changed: <code>pljava.classpath</code> is now <code>pljava.module_path</code>.</p>
<p>As before, its default value will be correct when PL/Java is installed to the usual locations. It should be rare for any installation to have needed to think about the old one, or to need to think about the new one. For a rare installation that does, the details are <a href="use/jpms.html">in the documentation</a>.</p>
<p>In this release, user code is not treated as modular; the <code>SQLJ.INSTALL_JAR</code> routine still treats its jars as unnamed-module code on a class path, as before.</p></section><section>
<h5><a name="Improvements_to_the_annotation-driven_SQL_generator"></a>Improvements to the annotation-driven SQL generator</h5><section>
<h6><a name="Infers_additional_implicit_ordering_dependencies"></a>Infers additional implicit ordering dependencies</h6>
<p>The SQL generator can now respect the implicit ordering constraints among user-defined types and functions that either use the types or are used in their definitions, which can eliminate many <code>provides</code>/<code>requires</code> annotation elements that had to be added by hand for PL/Java 1.5. The reduction in boilerplate needed for a realistic example can be seen by comparing the annotated version of Bear Giles&#x2019;s <code>pljava-udt-type-extension</code> example at <a class="externalLink" href="https://github.com/jcflack/pljava-udt-type-extension/commit/d32f84e">this commit</a> (pre-1.6) and <a class="externalLink" href="https://github.com/jcflack/pljava-udt-type-extension/commit/0066a1e">this one</a> (1.6.0).</p></section><section>
<h6><a name="Generates_variadic_function_declarations"></a>Generates variadic function declarations</h6>
<p>PL/Java 1.6 can declare functions that can be called from SQL with varying numbers of arguments. <a href="pljava-examples/apidocs/org/postgresql/pljava/example/annotation/Variadic.html#method.detail">Example code</a> is provided.</p></section></section><section>
<h5><a name="Better_support_for_PostgreSQL.E2.80.99s_SQL_ASCII_encoding"></a>Better support for PostgreSQL&#x2019;s <code>SQL_ASCII</code> encoding</h5>
<p>PostgreSQL&#x2019;s legacy <code>SQL_ASCII</code> encoding is difficult to use in Java because 128 of its code points have no defined mapping to Unicode, which Java uses. The page on <a href="use/charsets.html">database character set encodings</a> has a section suggesting workable approaches if PL/Java is used in a database with that encoding. A new addition among those options is a Java <code>Charset</code> supporting the encoding names <code>X-PGSQL_ASCII</code> or <code>SQL_ASCII</code>, which maps the ASCII characters as expected, and reversibly encodes the others using Unicode permanently-undefined codepoints.</p></section><section>
<h5><a name="Build_system.2C_continuous_integration.2C_quality_assurance"></a>Build system, continuous integration, quality assurance</h5>
<ul>

<li>

<p>The <code>nar-maven-plugin</code> formerly used in the build has been replaced with a newly-developed Maven plugin tailored to PostgreSQL extension building.</p>
</li>
<li>

<p>The new plugin respects the flags reported by <code>pg_config</code> when building the native library.</p>
</li>
<li>

<p>Building with the same flags used for PostgreSQL has eliminated the flood of uninformative warnings that, in prior versions, made troubleshooting actual build problems difficult.</p>
</li>
<li>

<p>Travis-CI and AppVeyor now regularly build and test PL/Java for Linux (x86_64 and ppc64le), Mac OS, and Windows (using MSVC and MinGW-w64), with results visible at GitHub.</p>
</li>
<li>

<p>PL/Java&#x2019;s self-installer jar now includes utilities to simplify integration testing, similar to the <code>PostgresNode</code> Perl module provided with PostgreSQL. It is used in the Travis and AppVeyor builds to keep platform-specific code to a minimum, and may be useful for other purposes. Some <a href="develop/node.html">documentation</a> is included.</p>
</li>
<li>

<p>Having fixed the permission issues that were breaking the profiling functions of <code>visualvm</code>, it will be easier to incorporate profiling into future development.</p>
</li>
</ul></section></section><section>
<h4><a name="Enhancement_requests_addressed"></a>Enhancement requests addressed</h4>
<ul>

<li><a class="externalLink" href="https://github.com/tada/pljava/issues/11">Add regression testing</a></li>
<li><a class="externalLink" href="https://github.com/tada/pljava/issues/152"><code>CFLAGS</code> from <code>pg_config</code> when building <code>pljava-so</code></a></li>
</ul></section><section>
<h4><a name="Bugs_fixed"></a>Bugs fixed</h4>
<ul>

<li><a class="externalLink" href="https://github.com/tada/pljava/issues/190"><code>-Dpljava.libjvmlocation</code> breaks Windows build</a></li>
<li><a class="externalLink" href="https://github.com/tada/pljava/issues/312">XML Schema regression-test failure in de_DE locale</a></li>
</ul></section><section>
<h4><a name="Updated_PostgreSQL_APIs_tracked"></a>Updated PostgreSQL APIs tracked</h4>
<ul>

<li>64-bit <code>FuncCallContext.call_cntr</code> (<code>ResultSetProvider</code>/<code>ResultSetHandle</code> can now return more than <code>INT_MAX</code> rows)</li>
</ul></section><section>
<h4><a name="Credits"></a>Credits</h4>
<p>There is a PL/Java 1.6.0 thanks in part to Christoph Berg, Chapman Flack, Kartik Ohri, original creator Thomas Hallgren, and the many contributors to earlier versions.</p>
<p>The work of Kartik Ohri in summer 2020 on the build system renovation and continuous integration was supported by Google Summer of Code.</p></section></section><section>
<h3><a name="Releases_prior_to_PL.2FJava_1.6.0"></a><a href="releasenotes-pre1_6.html">Releases prior to PL/Java 1.6.0</a></h3></section></section>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
        Copyright &#169;      2003&#x2013;2023<a href="http://tada.se/eng/">Tada AB</a>.
.      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
