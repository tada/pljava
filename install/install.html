<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia Site Renderer 1.6 at 2016-01-11 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>PostgreSQL PL/Java &#x2013; Installing PL/Java</title>
    <style type="text/css" media="all">
      @import url("../css/maven-base.css");
      @import url("../css/maven-theme.css");
      @import url("../css/site.css");
    </style>
    <link rel="stylesheet" href="../css/print.css" type="text/css" media="print" />
    <meta name="Date-Revision-yyyymmdd" content="20160111" />
    <meta http-equiv="Content-Language" content="en" />
        
        </head>
  <body class="composite">
    <div id="banner">
                        <a href="https://tada.github.io/pljava/" id="bannerLeft" title="PL/Java logo combining the PostgreSQL elephant and a Java bean">
                                                <img src="../images/pljava_logo.jpg" alt="PL/Java logo combining the PostgreSQL elephant and a Java bean" />
                </a>
                    <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
            
                    
                <div class="xleft">
        <span id="publishDate">Last Published: 2016-01-11</span>
                  &nbsp;| <span id="projectVersion">Version: 1.5.0-SNAPSHOT</span>
                      </div>
            <div class="xright">                    <a href="https://github.com/tada/pljava/wiki/" class="externalLink" title="Wiki">Wiki</a>
            |
                        <a href="https://github.com/tada/pljava/issues" class="externalLink" title="Issues">Issues</a>
            |
                        <a href="http://lists.pgfoundry.org/pipermail/pljava-dev/" class="externalLink" title="Mailing list">Mailing list</a>
            |
                        <a href="https://github.com/tada/pljava/tree/master/" class="externalLink" title="Code">Code</a>
              
                    
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
             
                    
                                <h5>Usage</h5>
                  <ul>
                  <li class="none">
                          <a href="../build/build.html" title="Building PL/Java">Building PL/Java</a>
            </li>
                  <li class="none">
            <strong>Installing into PostgreSQL</strong>
          </li>
                  <li class="none">
                          <a href="../use/use.html" title="User guide">User guide</a>
            </li>
          </ul>
                       <h5>Modules</h5>
                  <ul>
                  <li class="none">
                          <a href="../pljava-api/index.html" title="PL/Java API">PL/Java API</a>
            </li>
                  <li class="none">
                          <a href="../pljava/index.html" title="PL/Java backend Java code">PL/Java backend Java code</a>
            </li>
                  <li class="none">
                          <a href="../pljava-so/index.html" title="PL/Java backend native code">PL/Java backend native code</a>
            </li>
                  <li class="none">
                          <a href="../pljava-deploy/index.html" title="PL/Java Deploy">PL/Java Deploy</a>
            </li>
                  <li class="none">
                          <a href="../pljava-ant/index.html" title="PL/Java Ant tasks">PL/Java Ant tasks</a>
            </li>
                  <li class="none">
                          <a href="../pljava-examples/index.html" title="PL/Java examples">PL/Java examples</a>
            </li>
                  <li class="none">
                          <a href="../pljava-packaging/index.html" title="PL/Java packaging">PL/Java packaging</a>
            </li>
          </ul>
                       <h5>Project Documentation</h5>
                  <ul>
                                                                                                                                                                                                                                                                          <li class="collapsed">
                          <a href="../project-info.html" title="Project Information">Project Information</a>
                  </li>
          </ul>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="../images/logos/maven-feather.png" />
      </a>
                   
                    
            </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <h1>Installing PL/Java</h1>
<div class="section">
<h2><a name="For_the_impatient"></a>For the impatient</h2>
<p>After completing the <a href="../build/build.html">build</a>:</p>

<div class="source">
<div class="source">
<pre>java -jar pljava-packaging/target/pljava-pgX.Y-arch-os-link.jar
psql
CREATE EXTENSION pljava;
</pre></div></div>
<p>where <i>pgX.Y</i> represents the PostgreSQL version, and <i>arch</i>, <i>os</i>, and <i>link</i> are &#x2026; wait, you&#x2019;re impatient, just look in the directory, you&#x2019;ll see the jar file there.</p>
<p><i>Not running PostgreSQL 9.1 or higher? Use <tt>LOAD 'libpljava-so-1.5.0-SNAPSHOT';</tt> instead of the <tt>CREATE EXTENSION</tt> command. (It works in later versions too, if you prefer it to <tt>CREATE EXTENSION</tt>.) Using a Mac? Be sure to add <tt>.bundle</tt> at the end of the file name in the <tt>LOAD</tt> command. Windows? Remove <tt>lib</tt> from the front. Something else? Keep reading.</i></p>
<p>You may get a message that some configuration variable must be set. If so, keep reading.</p>
<div class="section">
<h3><a name="What_the_above_will_do"></a>What the above will do</h3>
<p>The jar file produced in <tt>pljava-packaging/target</tt> at the end of the build contains all the files needed to install PL/Java, and it is self-extracting when simply run with <tt>java -jar</tt>. It does not contain any complicated, black-box installer, and if you prefer, it is just as easy to extract normally with the <tt>jar</tt> command or any <tt>zip</tt> tool, in which case you will see that it contains files at symbolic paths such as</p>

<div class="source">
<div class="source">
<pre>pljava/pkglibdir/...
pljava/sharedir/...
</pre></div></div>
<p>which you can move to wherever you like. Those names are based on the options you would pass to <tt>pg_config</tt> to find the right locations for your PostgreSQL setup, and that is exactly what the self-extractor does. Assuming it is run with the permissions needed to write there, it will put the PL/Java files into the expected locations, so that <tt>CREATE EXTENSION</tt> will find it without much configuration needed.</p>
<p>Because that is done by the extractor, you can take the built jar file to other PostgreSQL installations, even with other filesystem layouts, and it will put the files in the right places there too.</p>
<p>It has to be able to find <tt>pg_config</tt>, and if you have more than one installation of PostgreSQL on the machine, it has to find the <i>right</i> <tt>pg_config</tt>. You can either arrange the path in your environment so the right <tt>pg_config</tt> comes first, or specify it with <tt>-Dpgconfig=</tt> on the command line:</p>

<div class="source">
<div class="source">
<pre>java -Dpgconfig=/local/pgsql/bin/pg_config -jar pljava-packaging/...
</pre></div></div>
<p>All of the standard install locations can also be changed with <tt>-D</tt> options:</p>

<div class="source">
<div class="source">
<pre>java -Dpgconfig.sharedir=/local/foo -jar pljava-packaging/...
</pre></div></div>
<p>would cause all the files that would normally go in the configured share directory to be placed in <tt>/local/foo</tt> instead. You can therefore install PL/Java in many situations where you might not have write access to the standard locations, or might have other reasons to prefer giving the files another location.</p>
<p>If you change locations, you will probably have to adjust some of PL/Java&#x2019;s configuration variables to match, before installation will succeed. For that, you will have to become patient, and read the rest of this page.</p>
<p><b>You will most probably have to set <tt>pljava.libjvm_location</tt>.</b> See the next section.</p>
<p><i>One last small thing the extractor does, that won&#x2019;t automatically happen if you extract with other tools, is make sure the text files have the right line-ending style for your system. Everything will still work, and there are easy fixes if you open them in an editor and they look funny. As long as you just extract with <tt>java -jar</tt> the self-extractor takes care of it for you.</i></p></div></div>
<div class="section">
<h2><a name="PLJava_configuration_variables"></a>PL/Java configuration variables</h2>
<p>PL/Java has configuration variables for most important file locations. One that you will <i>almost always have to set</i> is <tt>pljava.libjvm_location</tt> because the PL/Java installer doesn&#x2019;t control where different platforms and packagers put the Java files. <i>(If it did, things would be a lot more organized, have no doubt.)</i></p>
<p>You can set these variables within a database session, before issuing the <tt>LOAD</tt> or <tt>CREATE EXTENSION</tt> command. (In case you don&#x2019;t always get things right on the first try, you might set them after, too.) For example:</p>

<div class="source">
<div class="source">
<pre>SET pljava.libjvm_location TO '/usr/lib/jvm/java-1.8.0/lib/...';
</pre></div></div>

<dl>
<dt><tt>pljava.libjvm_location</tt></dt>
<dd>You are looking for a file named <tt>libjvm</tt> with extension <tt>.so</tt>, <tt>.dll</tt>, or <tt>.dylib</tt> typically, buried a few directories/folders down in the location where Java is installed. If more than one Java version is installed, be sure to find the library from the version you want PL/Java to use. See <a href="locatejvm.html">locating libjvm</a> for help finding it. Then set this variable to the full pathname, including the filename and extension.</dd>
<dt><tt>pljava.classpath</tt></dt>
<dd>There is probably no need to set this variable unless installation locations were changed, in which case, it should be set to the final installed full pathname of the file that is called <tt>pljava/sharedir/pljava/pljava-1.5.0-SNAPSHOT.jar</tt> in the installer jar. Note: this variable isn&#x2019;t meant to point to the code you develop and use in PL/Java&#x2013;that&#x2019;s what the <a class="externalLink" href="https://github.com/tada/pljava/wiki/SQL-functions"><tt>sqlj.install_jar function</tt></a> is for.</dd>
</dl>
<p>Those two are not the only PL/Java configuration variables there are, but it is unlikely you would have to change any others before installation succeeds. For the rest, there is a <a href="../use/variables.html">configuration variable reference</a> page.</p>
<p>One thing you can do with the configuration settings is quickly test that you have built a working PL/Java before installing the files in any permanent location. As long as the database server has access to the files in the build tree, you can start a session and set the variables to point to them, for a quick simple test. See <a href="locate.html">locating the built files</a> for how to find their exact names in your build tree. After testing, you would probably put the files in more permanent locations and discard the temporary variable settings.</p></div>
<div class="section">
<h2><a name="Making_the_configuration_settings_persistent"></a>Making the configuration settings persistent</h2>
<p>If you have loaded PL/Java successfully after making necessary changes to some <tt>pljava.*</tt> variables, and the files are in the final locations where you want them, you will want your variable settings to stick. The simplest way is to reissue the same <tt>SET</tt> commands as <tt>ALTER DATABASE</tt> <i>databasename</i> <tt>SET</tt> <i>variablename</i> <tt>FROM CURRENT</tt> commands, which will preserve the current settings and make them effective when any user connects to the same database.</p>
<p>Another approach is to save them to the server&#x2019;s configuration file. If you wish PL/Java to be available for all databases in a cluster, it may be more convenient to put the settings in the file than to issue <tt>ALTER DATABASE</tt> for several databases, but <tt>pg_ctl reload</tt> will be needed to make changed settings effective. Starting with PostgreSQL 9.4, <tt>ALTER SYSTEM</tt> may be used as an alternative to editing the file.</p>
<p>If you have several databases in the cluster and you favor the <tt>CREATE EXTENSION</tt> way of installing PL/Java, setting the variables with <tt>ALTER SYSTEM</tt> or the cluster-wide configuration file will make sure that <tt>CREATE EXTENSION</tt> just works, in any database where PL/Java is wanted. Different per-database settings can still be made if one database needs them.</p>
<p>For PostgreSQL releases <a href="prepg92.html">earlier than 9.2</a>, the configuration file is the <i>only</i> way to make your settings persistent.</p></div>
<div class="section">
<h2><a name="Special_topics"></a>Special topics</h2>
<p>Be sure to read these additional sections if:</p>

<ul>
  
<li>You are installing to <a href="prepg92.html">a PostgreSQL release earlier than 9.2</a></li>
  
<li>You are installing on <a href="selinux.html">a system using SELinux</a></li>
  
<li>You are installing on <a href="../build/macosx.html">Mac OS X</a></li>
</ul></div>
<div class="section">
<h2><a name="More_background_and_special_considerations"></a>More background and special considerations</h2>
<p>These last sections cover a little more of what happens under the hood. <tt>CREATE EXTENSION</tt> wraps these details up nicely, but they may still be of interest for particular needs.</p>
<div class="section">
<h3><a name="Install_configure_check"></a>Install, configure, check</h3>
<p>Because PL/Java, by design, runs entirely in the backend process created for each connection to PostgreSQL, to configure it does not require any cluster-wide actions such as stopping or restarting the server, or editing the configuration file; any necessary settings can be made in SQL over an ordinary connection (in PostgreSQL 9.2 and later, anyway).</p>
<p><i>Caution: if you are installing a new, little-tested PL/Java build, be aware that in the unexpected case of a crash, the <tt>postmaster</tt> will kick other sessions out of the database for a moment to verify integrity, and then let them reconnect. If that would be disruptive, it may be best to <tt>initdb</tt> a new cluster in some temporary location and test PL/Java there, installing to a production server only when satisfied.</i></p>
<p>After connecting to the desired database (the connection must be as a PostgreSQL superuser), the commands for first-time PL/Java setup are:</p>

<div class="source">
<div class="source">
<pre>SET client_min_messages TO NOTICE; -- or anything finer (INFO, DEBUG, ...)
SET pljava.libjvm_location TO ' use the libjvm path here ';
SET pljava.classpath TO ' use the pljava.jar path here ';
LOAD ' use the PL/Java native library path here ';
</pre></div></div>
<p>(The <tt>client_min_messages</tt> setting is only to ensure you do not miss the <tt>NOTICE</tt> message in case of success.) If you see</p>

<div class="source">
<div class="source">
<pre>NOTICE: PL/Java loaded
</pre></div></div>
<p>then you are ready to test some PL/Java functions, such as the ones in the <a href="../examples/examples.html"><tt>examples.jar</tt> supplied in the build</a>.</p>
<p>Although typically only <tt>pljava.libjvm_location</tt> and <tt>pljava.classpath</tt> need to be set, there is a <a href="../use/variables.html">reference to PL/Java configuration variables</a> if you need it.</p></div>
<div class="section">
<h3><a name="Choosing_where_to_place_the_files"></a>Choosing where to place the files</h3>
<p>Exactly where you place the files, and what pathnames you use in the above commands, can depend on your situation:</p>

<ul>
  
<li>Are you a superuser on the OS where PostgreSQL is installed (or are you a distribution maintainer building a PL/Java package for that platform)?</li>
  
<li>Are you not an OS superuser, but you have PostgreSQL superuser rights and OS permissions as the user that runs <tt>postgres</tt>?</li>
  
<li>Do you have only PostgreSQL superuser rights, no ability to write locations owned by the user <tt>postgres</tt> runs as, but the ability to write some locations that user can read?</li>
  
<li>Do you have PostgreSQL superuser rights and want to quickly test that you have built a working PL/Java?</li>
</ul>
<p>The rest of this page will cover those cases. First, the quick check.</p></div>
<div class="section">
<h3><a name="A_quick_install_check"></a>A quick install check</h3>
<p>For a quick sanity test, there is no need to move the built files to more permanent locations, as long as the build tree location and permissions are such that the PostgreSQL backend can read them where they are. Use those pathnames directly in the <tt>SET</tt> and <tt>LOAD</tt> commands.</p>
<p>For the lowest-impact quick test, begin a transaction first, load PL/Java and run <a href="../examples/examples.html">any tests you like</a>, then roll the transaction back.</p></div>
<div class="section">
<h3><a name="OS_superuser_or_distribution_maintainer"></a>OS superuser or distribution maintainer</h3>
<p>If you fall in this category, you can minimize configuration within PostgreSQL by placing the built files into standard locations, so <tt>SET</tt> commands are not needed for PostgreSQL to find them. For example, if the PL/Java native library is copied into the PostgreSQL <tt>$libdir</tt> (shown by <tt>pg_config</tt> as <tt>PKGLIBDIR</tt>), then the <tt>LOAD</tt> command can be given just the basename of the file instead of a full path. Or, if <tt>dynamic_library_path</tt> is already set, the file can be placed in any directory on that list for the same effect.</p>
<p>If the <tt>pljava-${project.version}.jar</tt> file is placed in the default location (typically a <tt>pljava</tt> subdirectory of the PostgreSQL &#x201c;share&#x201d; directory), then <tt>pljava.classpath</tt> will not need to be set.</p>
<p><b>If you are a distribution maintainer</b> packaging PL/Java for a certain platform, and you know or control that platform&#x2019;s conventions for where the Java <tt>libjvm</tt> should be found, or where PostgreSQL extension files (architecture-dependent and -independent) should go, please build your PL/Java package with those locations as the defaults for the corresponding PL/Java variables, and with the built files in those locations.</p>
<p><i>Todo: add maven build options usable by distro spinners to set those defaults.</i></p></div>
<div class="section">
<h3><a name="PostgreSQL_superuser_with_access_as_user_running_postgres"></a>PostgreSQL superuser with access as user running postgres</h3>
<p>If you are not a superuser on the OS, you may not be able to place the PL/Java files in the default locations PostgreSQL was built with. If you have permissions as the user running <tt>postgres</tt>, you might choose locations in a directory associated with that user, such as the <tt>DATADIR</tt>, and set the <tt>pljava.*</tt> variables to point to them. Use a <tt>LOAD</tt> command with the full path of the native library, or set <tt>dynamic_library_path</tt> to include its location, and give only the basename to <tt>LOAD</tt>.</p>
<p>If you would rather ensure that the user running <tt>postgres</tt>, if compromised, could not modify these files, then the next case will be more appropriate.</p></div>
<div class="section">
<h3><a name="PostgreSQL_superuser_OS_user_distinct_from_the_user_running_postgres"></a>PostgreSQL superuser, OS user distinct from the user running postgres</h3>
<p>In this case, simply place the files in any location where you can make them readable by the user running <tt>postgres</tt>, and set the <tt>pljava.*</tt> variables accordingly.</p></div></div>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
              Copyright &#169;                    2003&#x2013;2016
                        <a href="http://tada.se/eng/">Tada AB</a>.
            All rights reserved.      
                    
                  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
