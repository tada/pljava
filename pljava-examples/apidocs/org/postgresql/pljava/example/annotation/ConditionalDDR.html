<!DOCTYPE HTML>
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (15-ea) on Sun Oct 18 19:32:43 EDT 2020 -->
<title>ConditionalDDR (PL/Java examples 1.6.0)</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="dc.created" content="2020-10-18">
<meta name="description" content="declaration: package: org.postgresql.pljava.example.annotation, class: ConditionalDDR">
<meta name="generator" content="javadoc/ClassWriterImpl">
<link rel="stylesheet" type="text/css" href="../../../../../stylesheet.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../../script-dir/jquery-ui.min.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../../jquery-ui.overrides.css" title="Style">
<script type="text/javascript" src="../../../../../script.js"></script>
<script type="text/javascript" src="../../../../../script-dir/jquery-3.5.1.min.js"></script>
<script type="text/javascript" src="../../../../../script-dir/jquery-ui.min.js"></script>
</head>
<body class="class-declaration-page">
<script type="text/javascript">var pathtoroot = "../../../../../";
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<div class="flex-box">
<header role="banner" class="flex-header">
<nav role="navigation">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="top-nav" id="navbar.top">
<div class="skip-nav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<ul id="navbar.top.firstrow" class="nav-list" title="Navigation">
<li><a href="../../../../../index.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="nav-bar-cell1-rev">Class</li>
<li><a href="class-use/ConditionalDDR.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="sub-nav">
<div>
<ul class="sub-nav-list">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="sub-nav-list">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li>Method</li>
</ul>
</div>
<div class="nav-list-search"><label for="search">SEARCH:</label>
<input type="text" id="search" value="search" disabled="disabled">
<input type="reset" id="reset" value="reset" disabled="disabled">
</div>
</div>
<!-- ========= END OF TOP NAVBAR ========= -->
<span class="skip-nav" id="skip.navbar.top">
<!--   -->
</span></nav>
</header>
<div class="flex-content">
<main role="main">
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="sub-title"><span class="package-label-in-type">Package</span>&nbsp;<a href="package-summary.html">org.postgresql.pljava.example.annotation</a></div>
<h1 title="Class ConditionalDDR" class="title">Class ConditionalDDR</h1>
</div>
<div class="inheritance" title="Inheritance Tree"><a href="https://docs.oracle.com/en/java/javase/12/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">java.lang.Object</a>
<div class="inheritance">org.postgresql.pljava.example.annotation.ConditionalDDR</div>
</div>
<section class="description">
<hr>
<pre><a href="../../../../../../../pljava-api/apidocs/org.postgresql.pljava/org/postgresql/pljava/annotation/SQLAction.html" title="class or interface in org.postgresql.pljava.annotation" class="external-link">@SQLAction</a>(<a href="../../../../../../../pljava-api/apidocs/org.postgresql.pljava/org/postgresql/pljava/annotation/SQLAction.html#provides()" title="class or interface in org.postgresql.pljava.annotation" class="external-link">provides</a>={"LifeIsGood","LifeIsNotGood"},<a href="../../../../../../../pljava-api/apidocs/org.postgresql.pljava/org/postgresql/pljava/annotation/SQLAction.html#install()" title="class or interface in org.postgresql.pljava.annotation" class="external-link">install</a>="SELECT CASE 42 WHEN 42 THEN  set_config(\'pljava.implementors\', \'LifeIsGood,\' ||   current_setting(\'pljava.implementors\'), true) ELSE  set_config(\'pljava.implementors\', \'LifeIsNotGood,\' ||   current_setting(\'pljava.implementors\'), true) END") <a href="../../../../../../../pljava-api/apidocs/org.postgresql.pljava/org/postgresql/pljava/annotation/SQLAction.html" title="class or interface in org.postgresql.pljava.annotation" class="external-link">@SQLAction</a>(<a href="../../../../../../../pljava-api/apidocs/org.postgresql.pljava/org/postgresql/pljava/annotation/SQLAction.html#implementor()" title="class or interface in org.postgresql.pljava.annotation" class="external-link">implementor</a>="LifeIsGood",<a href="../../../../../../../pljava-api/apidocs/org.postgresql.pljava/org/postgresql/pljava/annotation/SQLAction.html#install()" title="class or interface in org.postgresql.pljava.annotation" class="external-link">install</a>="SELECT javatest.logmessage(\'INFO\', \'Looking good!\')") <a href="../../../../../../../pljava-api/apidocs/org.postgresql.pljava/org/postgresql/pljava/annotation/SQLAction.html" title="class or interface in org.postgresql.pljava.annotation" class="external-link">@SQLAction</a>(<a href="../../../../../../../pljava-api/apidocs/org.postgresql.pljava/org/postgresql/pljava/annotation/SQLAction.html#implementor()" title="class or interface in org.postgresql.pljava.annotation" class="external-link">implementor</a>="LifeIsNotGood",<a href="../../../../../../../pljava-api/apidocs/org.postgresql.pljava/org/postgresql/pljava/annotation/SQLAction.html#install()" title="class or interface in org.postgresql.pljava.annotation" class="external-link">install</a>="SELECT javatest.logmessage(\'WARNING\', \'This should not be executed\')") <a href="../../../../../../../pljava-api/apidocs/org.postgresql.pljava/org/postgresql/pljava/annotation/SQLAction.html" title="class or interface in org.postgresql.pljava.annotation" class="external-link">@SQLAction</a>(<a href="../../../../../../../pljava-api/apidocs/org.postgresql.pljava/org/postgresql/pljava/annotation/SQLAction.html#provides()" title="class or interface in org.postgresql.pljava.annotation" class="external-link">provides</a>="postgresql_ge_80300",<a href="../../../../../../../pljava-api/apidocs/org.postgresql.pljava/org/postgresql/pljava/annotation/SQLAction.html#install()" title="class or interface in org.postgresql.pljava.annotation" class="external-link">install</a>="SELECT CASE WHEN 80300 &lt;= CAST(current_setting(\'server_version_num\') AS integer) THEN set_config(\'pljava.implementors\', \'postgresql_ge_80300,\' ||  current_setting(\'pljava.implementors\'), true) END") <a href="../../../../../../../pljava-api/apidocs/org.postgresql.pljava/org/postgresql/pljava/annotation/SQLAction.html" title="class or interface in org.postgresql.pljava.annotation" class="external-link">@SQLAction</a>(<a href="../../../../../../../pljava-api/apidocs/org.postgresql.pljava/org/postgresql/pljava/annotation/SQLAction.html#provides()" title="class or interface in org.postgresql.pljava.annotation" class="external-link">provides</a>="postgresql_ge_80400",<a href="../../../../../../../pljava-api/apidocs/org.postgresql.pljava/org/postgresql/pljava/annotation/SQLAction.html#install()" title="class or interface in org.postgresql.pljava.annotation" class="external-link">install</a>="SELECT CASE WHEN 80400 &lt;= CAST(current_setting(\'server_version_num\') AS integer) THEN set_config(\'pljava.implementors\', \'postgresql_ge_80400,\' ||  current_setting(\'pljava.implementors\'), true) END") <a href="../../../../../../../pljava-api/apidocs/org.postgresql.pljava/org/postgresql/pljava/annotation/SQLAction.html" title="class or interface in org.postgresql.pljava.annotation" class="external-link">@SQLAction</a>(<a href="../../../../../../../pljava-api/apidocs/org.postgresql.pljava/org/postgresql/pljava/annotation/SQLAction.html#provides()" title="class or interface in org.postgresql.pljava.annotation" class="external-link">provides</a>="postgresql_ge_90000",<a href="../../../../../../../pljava-api/apidocs/org.postgresql.pljava/org/postgresql/pljava/annotation/SQLAction.html#install()" title="class or interface in org.postgresql.pljava.annotation" class="external-link">install</a>="SELECT CASE WHEN 90000 &lt;= CAST(current_setting(\'server_version_num\') AS integer) THEN set_config(\'pljava.implementors\', \'postgresql_ge_90000,\' ||  current_setting(\'pljava.implementors\'), true) END") <a href="../../../../../../../pljava-api/apidocs/org.postgresql.pljava/org/postgresql/pljava/annotation/SQLAction.html" title="class or interface in org.postgresql.pljava.annotation" class="external-link">@SQLAction</a>(<a href="../../../../../../../pljava-api/apidocs/org.postgresql.pljava/org/postgresql/pljava/annotation/SQLAction.html#provides()" title="class or interface in org.postgresql.pljava.annotation" class="external-link">provides</a>="postgresql_ge_90100",<a href="../../../../../../../pljava-api/apidocs/org.postgresql.pljava/org/postgresql/pljava/annotation/SQLAction.html#install()" title="class or interface in org.postgresql.pljava.annotation" class="external-link">install</a>="SELECT CASE WHEN 90100 &lt;= CAST(current_setting(\'server_version_num\') AS integer) THEN set_config(\'pljava.implementors\', \'postgresql_ge_90100,\' ||  current_setting(\'pljava.implementors\'), true) END") <a href="../../../../../../../pljava-api/apidocs/org.postgresql.pljava/org/postgresql/pljava/annotation/SQLAction.html" title="class or interface in org.postgresql.pljava.annotation" class="external-link">@SQLAction</a>(<a href="../../../../../../../pljava-api/apidocs/org.postgresql.pljava/org/postgresql/pljava/annotation/SQLAction.html#provides()" title="class or interface in org.postgresql.pljava.annotation" class="external-link">provides</a>="postgresql_ge_90300",<a href="../../../../../../../pljava-api/apidocs/org.postgresql.pljava/org/postgresql/pljava/annotation/SQLAction.html#install()" title="class or interface in org.postgresql.pljava.annotation" class="external-link">install</a>="SELECT CASE WHEN 90300 &lt;= CAST(current_setting(\'server_version_num\') AS integer) THEN set_config(\'pljava.implementors\', \'postgresql_ge_90300,\' ||  current_setting(\'pljava.implementors\'), true) END") <a href="../../../../../../../pljava-api/apidocs/org.postgresql.pljava/org/postgresql/pljava/annotation/SQLAction.html" title="class or interface in org.postgresql.pljava.annotation" class="external-link">@SQLAction</a>(<a href="../../../../../../../pljava-api/apidocs/org.postgresql.pljava/org/postgresql/pljava/annotation/SQLAction.html#provides()" title="class or interface in org.postgresql.pljava.annotation" class="external-link">provides</a>="postgresql_ge_100000",<a href="../../../../../../../pljava-api/apidocs/org.postgresql.pljava/org/postgresql/pljava/annotation/SQLAction.html#install()" title="class or interface in org.postgresql.pljava.annotation" class="external-link">install</a>="SELECT CASE WHEN 100000 &lt;= CAST(current_setting(\'server_version_num\') AS integer) THEN set_config(\'pljava.implementors\', \'postgresql_ge_100000,\' ||  current_setting(\'pljava.implementors\'), true) END")
public class <a href="../../../../../src-html/org/postgresql/pljava/example/annotation/ConditionalDDR.html#line.71">ConditionalDDR</a>
extends <a href="https://docs.oracle.com/en/java/javase/12/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a></pre>
<div class="block">Test of a very simple form of conditional execution in the deployment
 descriptor using only the <code>&lt;implementor name&gt;</code> specified for an
 <code>&lt;implementor block&gt;</code>.
 <p>
 When a deployment descriptor is executed, the config setting
 <code>pljava.implementors</code> determines which <code>&lt;implementor block&gt;</code>s
 will be executed (in addition to all of the plain <code>&lt;SQL statement&gt;</code>s
 that are not tagged with an implementor name). The default setting of
 <code>pljava.implementors</code> is simply <code>postgresql</code>.
 <p>
 In this example, an SQLAction (with the default implementor name PostgreSQL
 so it should always execute) tests some condition and, based on the result,
 adds <code>LifeIsGood</code> to the list of recognized implementor names.
 <p>
 Later SQLActions with that implementor name should also be executed, while
 those with a different, unrecognized implementor should not.
 <p>
 That is what happens at <em>deployment</em> (or undeployment) time, when the
 jar has been loaded into the target database and the deployment descriptor is
 being processed.
 <p>
 The <code>provides</code> and <code>requires</code> attributes matter at
 <em>compile</em> time: they are hints to the DDR generator so it will be sure
 to write the SQLAction that tests the condition ahead of the ones that
 depend on the condition having been tested. The example illustrates that an
 SQLAction's <code>implementor</code> is treated as an implicit <code>requires</code>.
 Unlike an explicit one, it is weak: if there is nothing declared that
 <code>provides</code> it, that's not an error; affected SQLActions will just be
 placed as late in the generated DDR as other dependencies allow, in case
 something in the preceding actions will be setting those implementor tags.
 <p>
 The implicit <code>requires</code> derived from an <code>implementor</code> is also
 special in another way: it does not have its sense reversed when generating
 the "undeploy" actions of the deployment descriptor. Ordinary requirements
 do, so the dependent objects get dropped before the things they depend on.
 But the code for setting a conditional implementor tag has to be placed
 ahead of the uses of the tag, whether deploying or undeploying.
 <p>
 An <code>SQLAction</code> setting an implementor tag does not need to have any
 <code>remove=</code> actions. If it does not (the usual case), its
 <code>install=</code> actions will be used in both sections of the deployment
 descriptor.
 <p>
 This example adds <code>LifeIsGood</code> ahead of the prior content of
 <code>pljava.implementors</code>. Simply replacing the value would stop the
 default implementor PostgreSQL being recognized, probably not what's wanted.
 The final <code>true</code> argument to <code>set_config</code> makes the setting
 local, so it is reverted when the transaction completes.
 <p>
 In addition to the goodness-of-life examples, this file also generates
 several statements setting PostgreSQL-version-based implementor tags that
 are relied on by various other examples in this directory.</div>
</section>
<section class="summary">
<ul class="summary-list">
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<li>
<section class="constructor-summary" id="constructor.summary">
<h2>Constructor Summary</h2>
<div class="member-summary">
<table class="summary-table">
<caption><span>Constructors</span></caption>
<thead>
<tr>
<th class="col-first" scope="col">Constructor</th>
<th class="col-last" scope="col">Description</th>
</tr>
</thead>
<tbody>
<tr class="alt-color">
<th class="col-constructor-name" scope="row"><code><span class="member-name-link"><a href="#%3Cinit%3E()">ConditionalDDR</a></span>()</code></th>
<td class="col-last">&nbsp;</td>
</tr>
</tbody>
</table>
</div>
</section>
</li>
<!-- ========== METHOD SUMMARY =========== -->
<li>
<section class="method-summary" id="method.summary">
<h2>Method Summary</h2>
<div class="inherited-list">
<h3 id="methods.inherited.from.class.java.lang.Object">Methods inherited from class&nbsp;java.lang.<a href="https://docs.oracle.com/en/java/javase/12/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a></h3>
<code><a href="https://docs.oracle.com/en/java/javase/12/docs/api/java.base/java/lang/Object.html#clone()" title="class or interface in java.lang" class="external-link">clone</a>, <a href="https://docs.oracle.com/en/java/javase/12/docs/api/java.base/java/lang/Object.html#equals(java.lang.Object)" title="class or interface in java.lang" class="external-link">equals</a>, <a href="https://docs.oracle.com/en/java/javase/12/docs/api/java.base/java/lang/Object.html#finalize()" title="class or interface in java.lang" class="external-link">finalize</a>, <a href="https://docs.oracle.com/en/java/javase/12/docs/api/java.base/java/lang/Object.html#getClass()" title="class or interface in java.lang" class="external-link">getClass</a>, <a href="https://docs.oracle.com/en/java/javase/12/docs/api/java.base/java/lang/Object.html#hashCode()" title="class or interface in java.lang" class="external-link">hashCode</a>, <a href="https://docs.oracle.com/en/java/javase/12/docs/api/java.base/java/lang/Object.html#notify()" title="class or interface in java.lang" class="external-link">notify</a>, <a href="https://docs.oracle.com/en/java/javase/12/docs/api/java.base/java/lang/Object.html#notifyAll()" title="class or interface in java.lang" class="external-link">notifyAll</a>, <a href="https://docs.oracle.com/en/java/javase/12/docs/api/java.base/java/lang/Object.html#toString()" title="class or interface in java.lang" class="external-link">toString</a>, <a href="https://docs.oracle.com/en/java/javase/12/docs/api/java.base/java/lang/Object.html#wait()" title="class or interface in java.lang" class="external-link">wait</a>, <a href="https://docs.oracle.com/en/java/javase/12/docs/api/java.base/java/lang/Object.html#wait(long)" title="class or interface in java.lang" class="external-link">wait</a>, <a href="https://docs.oracle.com/en/java/javase/12/docs/api/java.base/java/lang/Object.html#wait(long,int)" title="class or interface in java.lang" class="external-link">wait</a></code></div>
</section>
</li>
</ul>
</section>
<section class="details">
<ul class="details-list">
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<li>
<section class="constructor-details" id="constructor.detail">
<h2>Constructor Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="&lt;init&gt;()">
<h3>ConditionalDDR</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="member-name"><a href="../../../../../src-html/org/postgresql/pljava/example/annotation/ConditionalDDR.html#line.138">ConditionalDDR</a></span>()</div>
</section>
</li>
</ul>
</section>
</li>
</ul>
</section>
<!-- ========= END OF CLASS DATA ========= -->
</main>
<footer role="contentinfo">
<nav role="navigation">
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottom-nav" id="navbar.bottom">
<div class="skip-nav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<ul id="navbar.bottom.firstrow" class="nav-list" title="Navigation">
<li><a href="../../../../../index.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="nav-bar-cell1-rev">Class</li>
<li><a href="class-use/ConditionalDDR.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="sub-nav">
<div>
<ul class="sub-nav-list">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="sub-nav-list">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li>Method</li>
</ul>
</div>
</div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
<span class="skip-nav" id="skip.navbar.bottom">
<!--   -->
</span></nav>
<p class="legal-copy"><small>Copyright &#169; 2003&#x2013;2020<a href='http://tada.se/eng/'>Tada AB</a></small></p>
</footer>
</div>
</div>
</body>
</html>
